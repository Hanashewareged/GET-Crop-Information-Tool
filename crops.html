<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GET Crop Info Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        /* ALL YOUR EXISTING CSS STYLES REMAIN UNCHANGED */
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #388E3C;
            --light-color: #C8E6C9;
            --dark-color: #2E7D32;
            --text-color: #333;
            --background-color: #ffffff;
            --card-bg: white;
            --header-bg: var(--primary-color);
            --footer-bg: var(--dark-color);
            --section-bg: white;
            --tab-bg: #f1f1f1;
            --disease-bg: #f9f9f9;
            --input-bg: white;
            --input-border: var(--light-color);
            --admin-panel-bg: #f5f9ff;
            --admin-header-bg: #1a3c6c;
            --admin-card-bg: #ffffff;
            --admin-border: #d1e0f0;
            --admin-button: #2e7d32;
            --admin-button-hover: #1e5e22;
            --admin-delete: #d32f2f;
            --admin-delete-hover: #b71c1c;
            --chatbot-bg: #f0f7ff;
            --chatbot-user-bg: #e3f2fd;
            --feedback-bg: #fff9e6;
            --recommendation-bg: #f5f5f5;
        }

        .dark-mode {
            --primary-color: #4CAF50;
            --secondary-color: #388E3C;
            --light-color: #1E3A1F;
            --dark-color: #2E7D32;
            --text-color: #f0f0f0;
            --background-color: #121212;
            --card-bg: #1e1e1e;
            --header-bg: #1a1a1a;
            --footer-bg: #1a1a1a;
            --section-bg: #1e1e1e;
            --tab-bg: #2d2d2d;
            --disease-bg: #2d2d2d;
            --input-bg: #2d2d2d;
            --input-border: #444;
            --admin-panel-bg: #0d1b2a;
            --admin-header-bg: #0d1b2a;
            --admin-card-bg: #1b263b;
            --admin-border: #415a77;
            --admin-button: #4CAF50;
            --admin-button-hover: #388E3C;
            --admin-delete: #d32f2f;
            --admin-delete-hover: #b71c1c;
            --chatbot-bg: #1a237e;
            --chatbot-user-bg: #283593;
            --feedback-bg: #332900;
            --recommendation-bg: #1a1a1a;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            color: var(--text-color);
            background-color: var(--background-color);
            transition: all 0.3s ease;
            padding-top: 80px;
        }
        
        header {
            background-color: var(--header-bg);
            color: white;
            padding: 1rem;
            text-align: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.6);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .logo img {
            height: 40px;
            margin-right: 10px;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .theme-toggle {
            background: var(--card-bg);
            color: var(--primary-color);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .theme-toggle i {
            margin-right: 5px;
        }
        
        .language-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .language-button {
            background: var(--card-bg);
            color: var(--primary-color);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .language-button i {
            margin-left: 5px;
        }
        
        .language-options {
            display: none;
            position: absolute;
            right: 0;
            background-color: var(--card-bg);
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .language-options a {
            color: var(--text-color);
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }
        
        .language-options a:hover {
            background-color: var(--light-color);
        }
        
        .language-dropdown:hover .language-options {
            display: block;
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .hero {
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 4rem 2rem;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 2rem;
            position: relative;
        }
        
        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .hero p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto 2rem;
        }
        
        .search-container {
            display: flex;
            margin-bottom: 1rem;
            position: relative;
            max-width: 800px;
            margin: 0 auto;
        }
        
        #search-input {
            flex: 1;
            padding: 1rem;
            background-color: var(--input-bg);
            border: 2px solid var(--input-border);
            border-radius: 30px 0 0 30px;
            font-size: 1rem;
            outline: none;
            border-right: none;
            color: var(--text-color);
        }
        
        #search-input:focus {
            border-color: var(--primary-color);
        }
        
        #search-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0 30px 30px 0;
            padding: 0 1.5rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #search-button:hover {
            background-color: var(--secondary-color);
        }
        
        #search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--card-bg);
            border: 1px solid var(--input-border);
            border-radius: 0 0 10px 10px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .search-result-item {
            padding: 1rem;
            border-bottom: 1px solid var(--input-border);
            cursor: pointer;
            color: var(--text-color);
        }
        
        .search-result-item:hover {
            background-color: var(--light-color);
        }
        
        .no-results-message {
            text-align: center;
            padding: 2rem;
            font-size: 1.2rem;
            color: white;
            display: none;
            background-color: hsla(0, 23%, 75%, 0);
            border-radius: 10px;
            margin-top: 1rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .no-results-message i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: white;
        }
        
        .featured-crops {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }
        
        .crop-card {
            background: var(--card-bg);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
        }
        
        .crop-card:hover {
            transform: translateY(-5px);
        }
        
        .crop-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        
        .crop-card-content {
            padding: 1rem;
        }
        
        .crop-card h3 {
            margin: 0;
            color: var(--dark-color);
        }
        
        .about-section, .contact-section, .feedback-section {
            background: var(--section-bg);
            padding: 2rem;
            border-radius: 10px;
            margin: 2rem 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .feedback-section {
            background-color: var(--feedback-bg);
        }
        
        .section-title {
            color: var(--dark-color);
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .contact-methods {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
        }
        
        .contact-method {
            flex: 1;
            min-width: 200px;
        }
        
        .contact-method h4 {
            display: flex;
            align-items: center;
            color: var(--dark-color);
        }
        
        .contact-method i {
            margin-right: 10px;
            color: var(--primary-color);
        }
        
        .crop-display {
            display: none;
            background: var(--section-bg);
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .crop-header {
            display: flex;
            align-items: center;
            padding: 1rem;
            background-color: var(--light-color);
        }
        
        .crop-image {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 10px;
            margin-right: 1rem;
        }
        
        .crop-title {
            flex: 1;
        }
        
        .crop-name {
            font-size: 1.8rem;
            margin: 0;
            color: var(--dark-color);
        }
        
        .crop-scientific {
            font-style: italic;
            color: #666;
            margin: 0.5rem 0;
        }
        
        .back-button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 1rem;
            display: flex;
            align-items: center;
        }
        
        .back-button i {
            margin-right: 5px;
        }
        
        .crop-tabs {
            display: flex;
            border-bottom: 1px solid var(--input-border);
        }
        
        .crop-tab {
            padding: 1rem;
            cursor: pointer;
            flex: 1;
            text-align: center;
            background: var(--tab-bg);
            border-right: 1px solid var(--input-border);
        }
        
        .crop-tab:last-child {
            border-right: none;
        }
        
        .crop-tab.active {
            background: var(--section-bg);
            font-weight: bold;
            border-bottom: 3px solid var(--primary-color);
        }
        
        .crop-content {
            padding: 1rem;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .info-item {
            margin-bottom: 1rem;
        }
        
        .info-title {
            font-weight: bold;
            color: var(--dark-color);
            margin-bottom: 0.5rem;
        }
        
        .disease-item, .fertilizer-item {
            background: var(--disease-bg);
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 0.5rem;
        }
        
        .price-chart-container {
            width: 100%;
            height: 300px;
            margin: 1rem 0;
        }
        
        .success-rate-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            background-color: var(--primary-color);
            color: white;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        footer {
            background-color: var(--footer-bg);
            color: white;
            text-align: center;
            padding: 1rem;
            margin-top: 2rem;
            font-size: 0.9rem;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            text-align: left;
        }
        
        .footer-column h3 {
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
            display: inline-block;
            font-size: 1rem;
            margin-bottom: 0.8rem;
        }
        
        .footer-links {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .footer-links li {
            margin-bottom: 0.3rem;
        }
        
        .footer-links a {
            color: white;
            text-decoration: none;
            font-size: 0.85rem;
        }
        
        .footer-links a:hover {
            text-decoration: underline;
        }
        
        .copyright {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255,255,255,0.2);
            font-size: 0.8rem;
        }
        
        /* Admin Panel Styles */
        .admin-panel {
            background-color: var(--admin-panel-bg);
            border-radius: 10px;
            padding: 2rem;
            margin: 3rem 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: 1px solid var(--admin-border);
            display: none;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--admin-border);
        }
        
        .admin-title {
            color: var(--dark-color);
            margin: 0;
        }
        
        .admin-section {
            margin-bottom: 2rem;
        }
        
        .admin-subtitle {
            color: var(--dark-color);
            margin-bottom: 1rem;
        }
        
        .admin-form {
            background-color: var(--admin-card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 1.5rem;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--admin-border);
            border-radius: 4px;
            background-color: var(--input-bg);
            color: var(--text-color);
        }
        
        .admin-button {
            background-color: var(--admin-button);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .admin-button:hover {
            background-color: var(--admin-button-hover);
        }
        
        .delete-button {
            background-color: var(--admin-delete);
        }
        
        .delete-button:hover {
            background-color: var(--admin-delete-hover);
        }
        
        .crops-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .crops-table th,
        .crops-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--admin-border);
        }
        
        .crops-table th {
            background-color: var(--light-color);
            color: var(--dark-color);
        }
        
        .crops-table tr:hover {
            background-color: var(--disease-bg);
        }
        
        .action-cell {
            display: flex;
            gap: 8px;
        }
        
        .admin-login {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .admin-login input {
            padding: 0.5rem;
            border: 1px solid var(--admin-border);
            border-radius: 4px;
            background-color: var(--input-bg);
            color: var(--text-color);
        }
        
        .login-button {
            background-color: var(--admin-button);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .logout-button {
            background-color: var(--admin-delete);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            background-color: var(--card-bg);
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }

        .modal-title {
            margin-bottom: 1.5rem;
            color: var(--dark-color);
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            font-size: 1rem;
            background-color: var(--input-bg);
            color: var(--text-color);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .cancel-btn {
            background-color: var(--admin-delete);
            color: white;
            border: none;
            padding: 0.6rem 1rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .save-btn {
            background-color: var(--admin-button);
            color: white;
            border: none;
            padding: 0.6rem 1rem;
            border-Radius: 4px;
            cursor: pointer;
        }
        
        /* Welcome Screen Styles */
        .welcome-screen {
            text-align: center;
            padding: 3rem 1rem;
        }
        
        .welcome-title {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            color: var(--primary-color);
        }
        
        .user-selection {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 3rem;
            flex-wrap: wrap;
        }
        
        .user-card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 2rem;
            width: 300px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .user-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .user-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }
        
        .user-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--dark-color);
        }
        
        .user-description {
            color: var(--text-color);
            margin-bottom: 1.5rem;
        }
        
        .user-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            width: 100%;
        }
        
        .user-button:hover {
            background-color: var(--secondary-color);
        }
        
        /* Admin Dashboard Styles */
        .admin-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
            display: none;
        }
        
        .dashboard-card {
            background: var(--admin-card-bg);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .dashboard-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }
        
        .dashboard-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .dashboard-label {
            color: var(--text-color);
            font-size: 0.9rem;
        }
        
        /* Admin Tabs */
        .admin-tabs {
            display: flex;
            border-bottom: 1px solid var(--admin-border);
            margin-bottom: 1.5rem;
        }
        
        .admin-tab {
            padding: 1rem;
            cursor: pointer;
            background: var(--tab-bg);
            border-right: 1px solid var(--admin-border);
        }
        
        .admin-tab:last-child {
            border-right: none;
        }
        
        .admin-tab.active {
            background: var(--admin-card-bg);
            font-weight: bold;
            border-bottom: 3px solid var(--primary-color);
        }
        
        .admin-tab-content {
            display: none;
        }
        
        .admin-tab-content.active {
            display: block;
        }
        
        /* Back to selection button */
        .back-to-selection {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            margin: 1rem 0;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Chatbot Styles */
        .chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .chatbot-toggle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .chatbot-window {
            display: none;
            position: absolute;
            bottom: 70px;
            right: 0;
            width: 350px;
            height: 450px;
            background-color: var(--chatbot-bg);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            flex-direction: column;
        }
        
        .chatbot-header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chatbot-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }
        
        .message {
            margin-bottom: 1rem;
            padding: 0.8rem;
            border-radius: 10px;
            max-width: 80%;
        }
        
        .bot-message {
            background-color: var(--chatbot-bg);
            align-self: flex-start;
            border-bottom-left-radius: 0;
        }
        
        .user-message {
            background-color: var(--chatbot-user-bg);
            align-self: flex-end;
            margin-left: auto;
            border-bottom-right-radius: 0;
        }
        
        .chatbot-input {
            display: flex;
            padding: 0.5rem;
            border-top: 1px solid var(--input-border);
        }
        
        .chatbot-input input {
            flex: 1;
            padding: 0.8rem;
            border: 1px solid var(--input-border);
            border-radius: 20px;
            margin-right: 0.5rem;
        }
        
        .chatbot-input button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
        }
        
        /* Feedback Form Styles */
        .feedback-form {
            display: grid;
            gap: 1rem;
        }
        
        .feedback-form .form-group {
            min-width: 100%;
        }
        
        .feedback-form textarea {
            min-height: 150px;
        }
        
        /* Recommendation Page Styles */
        .recommendation-page {
            display: none;
            background: var(--section-bg);
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .recommendation-filters {
            background-color: var(--recommendation-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            background-color: var(--input-bg);
            color: var(--text-color);
        }
        
        .recommendation-results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .recommendation-card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .recommendation-card h3 {
            margin-top: 0;
            color: var(--dark-color);
        }
        
        .success-rate {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            background-color: var(--primary-color);
            color: white;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .download-section {
            margin-top: 2rem;
            text-align: center;
            padding: 1.5rem;
            background-color: var(--light-color);
            border-radius: 8px;
        }
        
        .download-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 0.5rem;
        }
        
        .download-btn:hover {
            background-color: var(--secondary-color);
        }
        
        /* Crop Recommendation Results */
        .recommendation-result {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .recommendation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .recommendation-score {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .recommendation-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .detail-item {
            margin-bottom: 0.5rem;
        }
        
        .detail-label {
            font-weight: bold;
            color: var(--dark-color);
        }
        
        /* Recommendation Column Styles */
        .recommendation-column {
            background-color: var(--light-color);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }
        
        .recommendation-item {
            background-color: var(--card-bg);
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .recommendation-item h4 {
            margin-top: 0;
            color: var(--dark-color);
            border-bottom: 1px solid var(--light-color);
            padding-bottom: 0.5rem;
        }
        
        /* Hamburger Menu Styles - IMPROVED */
        .hamburger-menu {
            position: fixed;
            top: 90px;
            left: 20px;
            z-index: 999;
        }
        
        .hamburger-icon {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            width: 60px;
            height: 60px;
        }
        
        .hamburger-icon:hover {
            background-color: var(--secondary-color);
            transform: scale(1.1);
        }
        
        .hamburger-icon i {
            font-size: 1.5rem;
        }
        
        .hamburger-content {
            display: none;
            position: absolute;
            left: 0;
            top: 70px;
            background-color: var(--card-bg);
            min-width: 250px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1000;
            border-radius: 8px;
            overflow: hidden;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .hamburger-content a {
            color: var(--text-color);
            padding: 14px 18px;
            text-decoration: none;
            display: flex;
            align-items: center;
            transition: background-color 0.2s ease;
            border-bottom: 1px solid var(--input-border);
        }
        
        .hamburger-content a:last-child {
            border-bottom: none;
        }
        
        .hamburger-content a:hover {
            background-color: var(--light-color);
        }
        
        .hamburger-content a i {
            margin-right: 8px;
            width: 20px;
            text-align: center;
            color: var(--primary-color);
        }
        
        .hamburger-menu.active .hamburger-content {
            display: block;
        }
        
        /* Crop Category Styles */
        .crop-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .category-btn {
            background-color: var(--light-color);
            color: var(--dark-color);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .category-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .category-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        /* Success Rate Chart Styles */
        .success-rate-chart-container {
            width: 100%;
            height: 300px;
            margin: 2rem 0;
        }
        
        /* Image Upload Styles */
        .image-upload-container {
            border: 2px dashed var(--input-border);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 1rem;
            cursor: pointer;
        }
        
        .image-upload-container.dragover {
            background-color: var(--light-color);
            border-color: var(--primary-color);
        }
        
        .image-upload-container i {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 1rem;
            display: none;
        }
        
        /* Summary Graph Page Styles */
        .summary-graph-page {
            display: none;
            background: var(--section-bg);
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .graph-container {
            width: 100%;
            height: 400px;
            margin: 2rem 0;
        }
        .admin-login-panel {
            background-color: var(--admin-panel-bg);
            border-radius: 10px;
            padding: 2rem;
            margin: 3rem auto;
            max-width: 500px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: 1px solid var(--admin-border);
            display: none;
        }
        #admin-panel {
            display: none;
        }
        @media (max-width: 768px) {
            .hero {
                padding: 2rem 1rem;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
            
            .crop-header {
                flex-direction: column;
                text-align: center;
            }
            
            .crop-image {
                margin-right: 0;
                margin-bottom: 1rem;
            }
            
            .crop-tabs {
                flex-direction: column;
            }
            
            .crop-tab {
                border-right: none;
                border-bottom: 1px solid var(--input-border);
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .action-cell {
                flex-direction: column;
            }
            
            .user-selection {
                flex-direction: column;
                align-items: center;
            }
            
            .admin-tabs {
                flex-direction: column;
            }
            
            .admin-tab {
                border-right: none;
                border-bottom: 1px solid var(--admin-border);
            }
            
            .chatbot-window {
                width: 300px;
                height: 400px;
                right: 10px;
            }
            
            .filter-row {
                flex-direction: column;
            }
            
            .search-container {
                flex-wrap: wrap;
            }
            
            .recommendation-details {
                grid-template-columns: 1fr;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .hamburger-menu {
                top: 80px;
                left: 10px;
            }
            
            .hamburger-content {
                position: fixed;
                top: 150px;
                left: 10px;
                right: 10px;
                width: auto;
                min-width: unset;
            }
            
            .crop-categories {
                overflow-x: auto;
                padding-bottom: 0.5rem;
            }
            
            .graph-container {
                height: 300px;
            }
        }
    </style>
</head>
<body>
  <!-- HEADER -->
<header>
    <div class="header-content">
        <div class="logo">
            <img src="https://img.pikbest.com/png-images/20241029/an-agriculture-logo-sun-and-crops-icon_11024322.png!sw800" alt="Crop Info Logo">
            <span>GET Crop Info Tool</span>
        </div>
        <div class="header-actions">
            <button class="theme-toggle" id="theme-toggle">
                <i class="fas fa-moon"></i>
                <span id="theme-text">Dark Mode</span>
            </button>
            <div class="language-dropdown">
                <button class="language-button" id="language-button">
                    <span id="current-language">English</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="language-options" id="language-options">
                    <a href="#" data-lang="en">English</a>
                    <a href="#" data-lang="am">አማርኛ</a>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- MAIN CONTENT -->
<div class="container">
    <!-- WELCOME SCREEN -->
    <div class="welcome-screen" id="welcome-screen">
        <h1 class="welcome-title" id="welcome-title">Welcome to GET Crop Info Tool</h1>
        <p id="welcome-text">Select your role to continue</p>
        
        <div class="user-selection">
            <div class="user-card" id="user-card">
                <div class="user-icon">
                    <i class="fas fa-user"></i>
                </div>
                <h3 class="user-title" id="user-title">User</h3>
                <p class="user-description" id="user-description">Browse crop information, search for specific crops, and learn about cultivation techniques.</p>
                <button class="user-button" id="user-button">Continue as User</button>
            </div>
            
            <div class="user-card" id="admin-card">
                <div class="user-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <h3 class="user-title" id="admin-title">Administrator</h3>
                <p class="user-description" id="admin-description">Manage crop database, add new crops, edit existing information, and maintain content.</p>
                <button class="user-button" id="admin-button">Continue as Admin</button>
            </div>
        </div>
    </div>

    <!-- USER INTERFACE -->
    <div id="home-page" style="display:none;">
        <button class="back-to-selection" id="back-to-selection-user">
            <i class="fas fa-arrow-left"></i> <span id="back-to-selection-text">Back to selection</span>
        </button>
        
        <!-- Improved Hamburger Menu -->
        <div class="hamburger-menu" id="hamburger-menu">
            <button class="hamburger-icon">
                <i class="fas fa-bars"></i>
            </button>
            <div class="hamburger-content">
                <a href="#" id="menu-feedback"><i class="fas fa-comments"></i> <span id="menu-feedback-text">Feedback</span></a>
                <a href="#" id="menu-recommendations"><i class="fas fa-lightbulb"></i> <span id="menu-recommendations-text">Recommendations</span></a>
                <a href="#" id="menu-about"><i class="fas fa-info-circle"></i> <span id="menu-about-text">About Us</span></a>
                <a href="#" id="menu-summary-graph"><i class="fas fa-chart-bar"></i> <span id="menu-summary-graph-text">Summary Graph</span></a>
            </div>
        </div>
        
        <section class="hero" id="hero-section">
            <h1 id="hero-title">Empowering Farmers with Crop Knowledge</h1>
            <p id="hero-text">Access comprehensive information about crop cultivation, diseases, and harvesting techniques in Ethiopia</p>
            <div class="search-container">
                <input type="text" id="search-input" placeholder="Search for a crop...">
                <button id="search-button"><i class="fas fa-search"></i> <span id="search-button-text">Search</span></button>
                <div id="search-results"></div>
            </div>
            <div class="no-results-message" id="no-results-message" style="display:none;">
                <i class="fas fa-exclamation-triangle"></i>
                <p id="no-results-text">No crops found matching your search</p>
            </div>
        </section>
        
        <!-- Crop Categories -->
       <div class="crop-categories" id="crop-categories">
  <button class="category-btn active" data-category-en="all" data-category-am="ሁሉም">All Crops</button>
  <button class="category-btn" data-category-en="Cereals/Grains" data-category-am="እህል እና ጥራጥሬ">Cereals/Grains</button>
  <button class="category-btn" data-category-en="Pulses/Legumes" data-category-am="ጥራጥሬዎች እና አባዝርት">Pulses/Legumes</button>
  <button class="category-btn" data-category-en="Tubers" data-category-am="አረንጓዴ አትክልቶች">Tubers</button>
  <button class="category-btn" data-category-en="Vegetables" data-category-am="አትክልቶች">Vegetables</button>
  <button class="category-btn" data-category-en="Fruits" data-category-am="ፍራፍሬዎች">Fruits</button>
  <button class="category-btn" data-category-en="Nuts" data-category-am="የለውዝ አይነቶች">Nuts</button>
  <button class="category-btn" data-category-en="Beverage Crops" data-category-am="የመጠጥ አትክልቶች">Beverage Crops</button>
  <button class="category-btn" data-category-en="Oilseed Crops" data-category-am="የቅባት እህሎች">Oilseed Crops</button>
</div>

        
        <h2 class="section-title" id="featured-crops-title">Featured Crops</h2>
        <div class="featured-crops" id="featured-crops"></div>
        
        <!-- Download Section - Only Excel -->
        <div class="download-section">
            <h2 id="download-title">Download Crop Information</h2>
            <p id="download-text">Get all crop information for offline use in Excel format</p>
            <button class="download-btn" id="download-excel"><i class="fas fa-file-excel"></i> <span>Download Excel</span></button>
        </div>
    </div>

    <!-- FEEDBACK PAGE -->
    <div class="feedback-section" id="feedback-page" style="display:none;">
        <button class="back-button" id="back-from-feedback">
            <i class="fas fa-arrow-left"></i> <span id="back-button-text">Back</span>
        </button>
        
        <h2 class="section-title" id="feedback-title">Send Feedback</h2>
        <div class="feedback-form">
            <div class="form-group">
                <label for="feedback-name" id="feedback-name-label">Your Name</label>
                <input type="text" id="feedback-name" required>
            </div>
            <div class="form-group">
                <label for="feedback-message" id="feedback-message-label">Your Feedback</label>
                <textarea id="feedback-message" required></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="save-btn" id="submit-feedback"><i class="fas fa-paper-plane"></i> <span id="submit-feedback-text">Submit Feedback</span></button>
            </div>
        </div>
    </div>
    
    <!-- RECOMMENDATIONS PAGE -->
    <div class="recommendation-column" id="recommendations-page" style="display:none;">
        <button class="back-button" id="back-from-recommendations">
            <i class="fas fa-arrow-left"></i> <span id="back-button-text">Back</span>
        </button>
        
        <h2 class="section-title" id="recommendations-title">Recommendations</h2>
        
        <div class="recommendation-filters">
            <h3 id="filter-options-title">Filter Options</h3>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="altitude-filter" id="altitude-filter-label">Altitude (meters)</label>
                    <select id="altitude-filter">
                        <option value="">Any Altitude</option>
                        <option value="low">Low (0-1500m)</option>
                        <option value="medium">Medium (1500-2500m)</option>
                        <option value="high">High (2500m+)</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="rainfall-filter" id="rainfall-filter-label">Rainfall (mm/year)</label>
                    <select id="rainfall-filter">
                        <option value="">Any Rainfall</option>
                        <option value="low">Low (&lt;500mm)</option>
                        <option value="medium">Medium (500-1000mm)</option>
                        <option value="high">High (&gt;1000mm)</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="soil-type-filter" id="soil-type-filter-label">Soil Type</label>
                    <select id="soil-type-filter">
                        <option value="">Any Soil Type</option>
                        <option value="clay">Clay</option>
                        <option value="loam">Loam</option>
                        <option value="sandy">Sandy</option>
                        <option value="volcanic">Volcanic</option>
                    </select>
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="season-filter" id="season-filter-label">Planting Season</label>
                    <select id="season-filter">
                        <option value="">Any Season</option>
                        <option value="spring">Spring</option>
                        <option value="summer">Summer</option>
                        <option value="autumn">Autumn</option>
                        <option value="winter">Winter</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="market-filter" id="market-filter-label">Market Purpose</label>
                    <select id="market-filter">
                        <option value="">Any Purpose</option>
                        <option value="local">Local Consumption</option>
                        <option value="export">Export</option>
                        <option value="processing">Processing</option>
                    </select>
                </div>
            </div>
            <button class="admin-button" id="apply-filters"><i class="fas fa-filter"></i> <span id="apply-filters-text">Apply Filters</span></button>
        </div>
        
        <div class="recommendation-results" id="recommendation-results">
            <!-- Results will be populated here -->
        </div>
    </div>
    
    <!-- ABOUT US PAGE -->
    <div class="about-section" id="about-page" style="display:none;">
        <button class="back-button" id="back-from-about">
            <i class="fas fa-arrow-left"></i> <span id="back-button-text">Back</span>
        </button>
        
        <h2 class="section-title" id="about-title">About Us</h2>
        <p id="about-text-1">GET Crop Info Tool is a comprehensive agricultural information platform designed specifically for Ethiopian farmers. Our mission is to provide accessible, accurate, and practical information to help farmers improve their crop yields and farming practices.</p>
        <p id="about-text-2">Developed in collaboration with agricultural experts from across Ethiopia, our database contains detailed information about the most important crops grown in the country, including traditional staples and cash crops.</p>
        
        <h3 class="section-title" id="mission-title">Our Mission</h3>
        <p id="mission-text">To empower Ethiopian farmers with comprehensive, accessible, and accurate agricultural information that improves crop productivity, promotes sustainable farming practices, and enhances food security.</p>
        
        <h3 class="section-title" id="vision-title">Our Vision</h3>
        <p id="vision-text">To become Ethiopia's leading digital agricultural resource, transforming traditional farming through technology and knowledge sharing to create a more food-secure and prosperous agricultural sector.</p>
        
        <h3 class="section-title" id="goals-title">Our Goals</h3>
        <ul id="goals-list">
            <li id="goal-1">Provide detailed information on 50+ Ethiopian crops in both English and Amharic</li>
            <li id="goal-2">Reach over 100,000 farmers across all regions of Ethiopia</li>
            <li id="goal-3">Increase crop success rates by at least 25% through better information access</li>
            <li id="goal-4">Develop mobile applications for offline access in remote areas</li>
            <li id="goal-5">Establish partnerships with agricultural extension services nationwide</li>
        </ul>
        
        <h3 class="section-title" id="contact-title">Contact Us</h3>
        <div class="contact-methods">
            <div class="contact-method">
                <h4><i class="fas fa-phone"></i> <span id="phone-title">Phone</span></h4>
                <p>+251 934504257</p>
            </div>
            <div class="contact-method">
                <h4><i class="fas fa-envelope"></i> <span id="email-title">Email</span></h4>
                <p>info@getcropinfo.et</p>
            </div>
            <div class="contact-method">
                <h4><i class="fas fa-map-marker-alt"></i> <span id="address-title">Address</span></h4>
                <p id="address-text">Addis Ababa, Ethiopia</p>
            </div>
        </div>
    </div>

    <!-- SUMMARY GRAPH PAGE -->
    <div class="summary-graph-page" id="summary-graph-page" style="display:none;">
        <button class="back-button" id="back-from-summary-graph">
            <i class="fas fa-arrow-left"></i> <span id="back-button-text">Back</span>
        </button>
        
        <h2 class="section-title" id="summary-graph-title">Crop Performance Analysis</h2>
        
        <div class="recommendation-filters">
            <h3 id="chart-options-title">Chart Options</h3>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="chart-type-filter">Chart Type</label>
                    <select id="chart-type-filter">
                        <option value="bar">Bar Chart</option>
                        <option value="line">Line Chart</option>
                        <option value="radar">Radar Chart</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="category-filter">Category</label>
                    <select id="category-filter">
                        <option value="all">All Categories</option>
                        <option value="Cereals/Grains">Cereals/Grains</option>
                        <option value="Pulses/Legumes">Pulses/Legumes</option>
                        <option value="Tubers">Tubers</option>
                        <option value="Vegetables">Vegetables</option>
                        <option value="Fruits">Fruits</option>
                        <option value="Nuts">Nuts</option>
                        <option value="Beverage Crops">Beverage Crops</option>
                        <option value="Oilseed Crops">Oilseed Crops</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="metric-filter">Performance Metric</label>
                    <select id="metric-filter">
                        <option value="yield">Yield Potential</option>
                        <option value="disease">Disease Resistance</option>
                        <option value="market">Market Value</option>
                    </select>
                </div>
            </div>
            <button class="admin-button" id="update-chart"><i class="fas fa-sync-alt"></i> Update Chart</button>
        </div>
        
        <div class="graph-container">
            <canvas id="performance-chart"></canvas>
        </div>
    </div>

    <!-- CROP DISPLAY -->
    <div class="crop-display" id="crop-display" style="display:none;">
        <div class="crop-header">
            <img src="" alt="Crop Image" class="crop-image" id="crop-image">
            <div class="crop-title">
                <h1 class="crop-name" id="crop-name"></h1>
                <p class="crop-scientific" id="crop-scientific"></p>
                <button class="download-btn" id="download-crop-excel"><i class="fas fa-file-excel"></i> <span id="download-crop-excel-text">Download Excel</span></button>
            </div>
        </div>
        
        <div class="crop-tabs">
            <div class="crop-tab active" data-tab="overview"><span id="overview-tab-text">Overview</span></div>
            <div class="crop-tab" data-tab="cultivation"><span id="cultivation-tab-text">Cultivation</span></div>
            <div class="crop-tab" data-tab="fertilizers"><span id="fertilizers-tab-text">Fertilizers</span></div>
            <div class="crop-tab" data-tab="diseases"><span id="diseases-tab-text">Diseases</span></div>
            <div class="crop-tab" data-tab="harvesting"><span id="harvesting-tab-text">Harvesting</span></div>
            <div class="crop-tab" data-tab="pricing"><span id="pricing-tab-text">Pricing</span></div>
            <div class="crop-tab" data-tab="recommendations"><span id="recommendations-tab-text">Recommendations</span></div>
            <div class="crop-tab" data-tab="varieties"><span id="varieties-tab-text">varieties
            </span></div>
        </div>
        
        <div class="crop-content">
            <div class="tab-content active" id="overview-tab">
                <div class="info-item"><div class="info-title" id="planting-time-title">Planting Time</div><p id="planting-time"></p></div>
                <div class="info-item"><div class="info-title" id="growing-period-title">Growing Period</div><p id="growing-period"></p></div>
                <div class="info-item"><div class="info-title" id="climate-requirements-title">Climate Requirements</div><p id="climate-requirements"></p></div>
                <div class="info-item"><div class="info-title" id="soil-type-title">Soil Type</div><p id="soil-type"></p></div>
                <div class="info-item"><div class="info-title" id="water-requirements-title">Water Requirements</div><p id="water-requirements"></p></div>
            </div>
            
            <div class="tab-content" id="cultivation-tab">
                <div class="info-item"><div class="info-title" id="land-preparation-title">Land Preparation</div><p id="land-preparation"></p></div>
                <div class="info-item"><div class="info-title" id="planting-method-title">Planting Method</div><p id="planting-method"></p></div>
                <div class="info-item"><div class="info-title" id="spacing-title">Spacing</div><p id="spacing"></p></div>
                
            </div>
            
            <div class="tab-content" id="fertilizers-tab"><div id="fertilizers-list"></div></div>
            
            <div class="tab-content" id="diseases-tab">
               

                <h3 id="disease-control-title">Disease Control</h3>
                <div id="diseases-list"></div>

                <h3 id="pest-control-title">Pest Control</h3>
                <div id="pest-control-list"></div>
            </div>
            
            <div class="tab-content" id="harvesting-tab">
                <div class="info-item"><div class="info-title" id="harvest-time-title">Harvest Time</div><p id="harvest-time"></p></div>
                <div class="info-item"><div class="info-title" id="harvest-method-title">Harvesting Method</div><p id="harvest-method"></p></div>
                <div class="info-item"><div class="info-title" id="yield-title">Expected Yield</div><p id="yield"></p></div>
                <div class="info-item"><div class="info-title" id="post-harvest-title">Post-Harvest Handling</div><p id="post-harvest"></p></div>
                
            </div>
            
            <div class="tab-content" id="pricing-tab">
                <div class="info-item"><div class="info-title" id="market-price-title">Market Price (per kg)</div><p id="market-price"></p></div>
                <div class="info-item"><div class="info-title" id="price-trend-title">Price Trend</div><p id="price-trend"></p></div>
                <div class="info-item"><div class="info-title" id="market-demand-title">Market Demand</div><p id="market-demand"></p></div>
                <div class="info-item"><div class="info-title" id="export-potential-title">Export Potential</div><p id="export-potential"></p></div>
            </div>
            
            <div class="tab-content" id="recommendations-tab">
                <div id="crop-recommendations-list"></div>
            </div>
            
            <div class="tab-content" id="varieties-tab">
                <div id="varieties-list"></div>
            </div>
        </div>
        
        <button class="back-button" id="back-button"><i class="fas fa-arrow-left"></i> <span id="back-button-text">Back</span></button>
    </div>
    
    <!-- ADMIN LOGIN -->
    <div class="admin-login-panel" id="admin-login-panel" style="display:none;">
        <button class="back-to-selection" id="back-to-selection-login">
            <i class="fas fa-arrow-left"></i> <span id="back-to-selection-text-login">Back to selection</span>
        </button>
        
        <div class="admin-form">
            <h2 class="admin-title" id="admin-login-title">Admin Login</h2>
            <div class="form-group">
                <label for="admin-password-input" id="admin-password-label">Password</label>
                <input type="password" id="admin-password-input" placeholder="Enter admin password">
            </div>
            <div class="form-actions">
                <button type="button" class="cancel-btn" id="admin-login-cancel"><span id="admin-cancel-text">Cancel</span></button>
                <button type="button" class="save-btn" id="admin-login-submit"><span id="admin-login-text">Login</span></button>
            </div>
        </div>
    </div>
    
    
    <!-- ADMIN PANEL -->
    <div class="admin-panel" id="admin-panel" style="display:none;">
        <button class="back-to-selection" id="back-to-selection-admin">
            <i class="fas fa-arrow-left"></i> <span id="back-to-selection-text-admin">Back to selection</span>
        </button>
        
        <div class="admin-header">
            <h2 class="admin-title" id="admin-dashboard-title">Admin Dashboard</h2>
            <div>
                <button class="admin-button" id="refresh-crops"><i class="fas fa-sync-alt"></i> <span id="refresh-crops-text">Refresh</span></button>
                <button class="logout-button" id="admin-logout-button"><i class="fas fa-sign-out-alt"></i> <span id="admin-logout-text">Logout</span></button>
            </div>
        </div>
        
        <div class="admin-tabs">
            <div class="admin-tab active" data-tab="dashboard"><i class="fas fa-chart-line"></i> <span id="dashboard-tab-text">Dashboard</span></div>
            <div class="admin-tab" data-tab="crops"><i class="fas fa-seedling"></i> <span id="crops-tab-text">Crop Management</span></div>
            <div class="admin-tab" data-tab="feedback"><i class="fas fa-comments"></i> <span id="feedback-tab-text">User Feedback</span></div>
        </div>
        
        <div class="admin-tab-content active" id="dashboard-tab">
            <div class="admin-dashboard">
                <div class="dashboard-card">
                    <div class="dashboard-icon">
                        <i class="fas fa-seedling"></i>
                    </div>
                    <div class="dashboard-value" id="total-crops"></div>
                    <div class="dashboard-label" id="total-crops-label">Total Crops</div>
                </div>
                
                <div class="dashboard-card">
                    <div class="dashboard-icon">
                        <i class="fas fa-eye"></i>
                    </div>
                    <div class="dashboard-value" id="total-views">1,243</div>
                    <div class="dashboard-label" id="total-views-label">Total Views</div>
                </div>
                
                <div class="dashboard-card">
                    <div class="dashboard-icon">
                        <i class="fas fa-download"></i>
                    </div>
                    <div class dashboard-value" id="total-downloads">328</div>
                    <div class="dashboard-label" id="total-downloads-label">Information Downloads</div>
                </div>
                
                <div class="dashboard-card">
                    <div class="dashboard-icon">
                        <i class="fas fa-comment"></i>
                    </div>
                    <div class="dashboard-value" id="total-feedback">47</div>
                    <div class="dashboard-label" id="total-feedback-label">Feedback Items</div>
                </div>
            </div>
            
            <div class="admin-section">
                <h3 class="admin-subtitle" id="recent-activity-title">Recent Activity</h3>
                <div class="admin-form">
                    <div id="recent-activity-list">
                        <!-- Recent activity will be populated here -->
                    </div>
                </div>
            </div>
        </div>
        
        <div class="admin-tab-content" id="crops-tab">
            <div class="admin-section">
                <div class="admin-header">
                    <h3 class="admin-subtitle" id="manage-crops-title">Manage Crops</h3>
                    <button class="admin-button" id="add-crop-btn"><i class="fas fa-plus"></i> <span id="add-crop-text">Add New Crop</span></button>
                </div>
                <div class="table-container">
                    <table class="crops-table">
                        <thead>
                            <tr>
                                <th id="crop-name-header">Name</th>
                                <th id="scientific-name-header">Scientific Name</th>
                                <th id="date-added-header">Date Added</th>
                                <th id="actions-header">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="crops-table-body">
                            <!-- Crops will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="admin-tab-content" id="feedback-tab">
            <div class="admin-section">
                <h3 class="admin-subtitle" id="user-feedback-title">User Feedback</h3>
                <div class="table-container">
                    <table class="crops-table">
                        <thead>
                            <tr>
                                <th id="feedback-name-header">Name</th>
                                <th id="feedback-date-header">Date</th>
                                <th id="feedback-message-header">Feedback</th>
                                <th id="feedback-actions-header">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="feedback-table-body">
                            <!-- Feedback will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit Crop Modal -->
<div class="modal" id="crop-modal">
    <div class="modal-content">
        <button class="modal-close" id="modal-close">
            <i class="fas fa-times"></i>
        </button>
        <h2 class="modal-title" id="modal-title">Add New Crop</h2>
        <form id="crop-form">
            <input type="hidden" id="crop-id">
            
            <div class="form-group">
                <label id="name-en-label">Name (English)</label>
                <input type="text" id="name-en" required>
            </div>
            
            <div class="form-group">
                <label id="name-am-label">Name (Amharic)</label>
                <input type="text" id="name-am" required>
            </div>
            
            <div class="form-group">
                <label id="scientific-name-label">Scientific Name</label>
                <input type="text" id="scientific-name" required>
            </div>
            
            <div class="form-group">
                <label id="category-en-label">Category (English)</label>
                <input type="text" id="category-en" placeholder="e.g., Cereals/Grains" required>
            </div>
            
            <div class="form-group">
                <label id="category-am-label">Category (Amharic)</label>
                <input type="text" id="category-am" placeholder="e.g., እህል እና ጥራጥሬ" required>
            </div>
            
            <h3 id="varieties-label">Crop Varieties</h3>
<div id="varieties-container">
  <div class="variety-group">
    <div class="form-group">
      <label>Variety Name (English)</label>
      <input type="text" name="variety-en[]">
    </div>
    <div class="form-group">
      <label>Variety Name (Amharic)</label>
      <input type="text" name="variety-am[]">
    </div>
    <div class="form-group">
      <label>Growing Time (days)</label>
      <input type="number" name="variety-days[]">
    </div>
    <div class="form-group">
      <label>Preferred Use (English)</label>
      <input type="text" name="variety-use-en[]">
    </div>
    <div class="form-group">
      <label>Preferred Use (Amharic)</label>
      <input type="text" name="variety-use-am[]">
    </div>
    <div class="form-group">
      <label>Disease Resistance (English)</label>
      <input type="text" name="variety-disease-en[]">
    </div>
    <div class="form-group">
      <label>Disease Resistance (Amharic)</label>
      <input type="text" name="variety-disease-am[]">
    </div>
    <div class="form-group">
      <label>Fertilizer Requirements (English)</label>
      <input type="text" name="variety-fertilizer-en[]">
    </div>
    <div class="form-group">
      <label>Fertilizer Requirements (Amharic)</label>
      <input type="text" name="variety-fertilizer-am[]">
    </div>
  </div>
</div>

<button type="button" class="admin-button" id="add-variety-btn">
  <i class="fas fa-plus"></i> Add Another Variety
</button>

            <div class="form-group">
                <label id="image-upload-label">Crop Image</label>
                <div class="image-upload-container" id="image-upload-container">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p id="image-upload-text">Drag & drop an image here or click to browse</p>
                    <input type="file" id="image-upload-input" accept="image/*" style="display: none;">
                    <img id="image-preview" class="image-preview" src="" alt="Image preview">
                </div>
            </div>

            <h3 id="climate-requirements-label">Overview</h3>
            <div class="form-group">
                <label id="planting-en-label">Planting Time (English)</label>
                <input type="text" id="planting-en">
            </div>
            <div class="form-group">
                <label id="planting-am-label">Planting Time (Amharic)</label>
                <input type="text" id="planting-am">
            </div>
            <div class="form-group">
                <label id="growing-en-label">Growing Period (English)</label>
                <input type="text" id="growing-en">
            </div>
            <div class="form-group">
                <label id="growing-am-label">Growing Period (Amharic)</label>
                <input type="text" id="growing-am">
            </div>
            <div class="form-group">
                <label id="climate-en-label">Climate Requirements (English)</label>
                <input type="text" id="climate-en">
            </div>
            <div class="form-group">
                <label id="climate-am-label">Climate Requirements (Amharic)</label>
                <input type="text" id="climate-am">
            </div>
            <div class="form-group">
                <label id="soil-en-label">Soil Type (English)</label>
                <input type="text" id="soil-en">
            </div>
            <div class="form-group">
                <label id="soil-am-label">Soil Type (Amharic)</label>
                <input type="text" id="soil-am">
            </div>
            
            <h3 id="cultivation-practices-label">Cultivation Practices</h3>
            <div class="form-group">
                <label id="landprep-en-label">Land Preparation (English)</label>
                <textarea id="landprep-en"></textarea>
            </div>
            <div class="form-group">
                <label id="landprep-am-label">Land Preparation (Amharic)</label>
                <textarea id="landprep-am"></textarea>
            </div>
            <div class="form-group">
                <label id="plantingmethod-en-label">Planting Method (English)</label>
                <textarea id="plantingmethod-en"></textarea>
            </div>
            <div class="form-group">
                <label id="plantingmethod-am-label">Planting Method (Amharic)</label>
                <textarea id="plantingmethod-am"></textarea>
            </div>
            <div class="form-group">
                <label id="spacing-en-label">Spacing (English)</label>
                <input type="text" id="spacing-en">
            </div>
            <div class="form-group">
                <label id="spacing-am-label">Spacing (Amharic)</label>
                <input type="text" id="spacing-am">
            </div>
            <div class="form-group">
                <label id="water-en-label">Water Requirements (English)</label>
                <input type="text" id="water-en">
            </div>
            <div class="form-group">
                <label id="water-am-label">Water Requirements (Amharic)</label>
                <input type="text" id="water-am">
            </div>

        <h3 id="fertilizer-usage-label">Fertilizer Usage</h3>
<div id="fertilizers-container">
  <div class="fertilizer-group">
    <div class="form-group">
      <label>Fertilizer Type (English)</label>
      <input type="text" name="fert-type-en[]" placeholder="e.g., DAP">
    </div>
    <div class="form-group">
      <label>Fertilizer Type (Amharic)</label>
      <input type="text" name="fert-type-am[]" placeholder="e.g., ዲኤፒ">
    </div>
    <div class="form-group">
      <label>Application (English)</label>
      <input type="text" name="fert-app-en[]" placeholder="e.g., Apply 100-200 kg/ha at planting">
    </div>
    <div class="form-group">
      <label>Application (Amharic)</label>
      <input type="text" name="fert-app-am[]" placeholder="ለምሳሌ፡ 100-200 ኪ.ግ/ሄክታር በመትከል ጊዜ">
    </div>
    <div class="form-group">
      <label>Benefits (English)</label>
      <input type="text" name="fert-benefits-en[]" placeholder="e.g., Provides phosphorus for root development">
    </div>
    <div class="form-group">
      <label>Benefits (Amharic)</label>
      <input type="text" name="fert-benefits-am[]" placeholder="ለምሳሌ፡ ለስር እድገት ፎስፈረስ ያቀርባል">
    </div>
  </div>
</div>

<button type="button" class="admin-button" id="add-fertilizer-btn">
  <i class="fas fa-plus"></i> Add Another Fertilizer
</button>

            <h3 id="disease-control-label">Disease Control</h3>
            <div class="form-group">
                <label id="disease1-name-en-label">Disease Name (English)</label>
                <input type="text" id="disease1-name-en">
            </div>
            <div class="form-group">
                <label id="disease1-name-am-label">Disease Name (Amharic)</label>
                <input type="text" id="disease1-name-am">
            </div>
            <div class="form-group">
                <label id="disease1-symptom-en-label">Symptoms (English)</label>
                <textarea id="disease1-symptom-en"></textarea>
            </div>
            <div class="form-group">
                <label id="disease1-symptom-am-label">Symptoms (Amharic)</label>
                <textarea id="disease1-symptom-am"></textarea>
            </div>
            <div class="form-group">
                <label id="disease1-control-en-label">Control (English)</label>
                <textarea id="disease1-control-en"></textarea>
            </div>
            <div class="form-group">
                <label id="disease1-control-am-label">Control (Amharic)</label>
                <textarea id="disease1-control-am"></textarea>
            </div>

            <h3 id="pest-control-label">Pest Control</h3>
            <div class="form-group">
                <label id="pest1-name-en-label">Pest Name (English)</label>
                <input type="text" id="pest1-name-en">
            </div>
            <div class="form-group">
                <label id="pest1-name-am-label">Pest Name (Amharic)</label>
                <input type="text" id="pest1-name-am">
            </div>
            <div class="form-group">
                <label id="pest1-symptom-en-label">Symptoms (English)</label>
                <textarea id="pest1-symptom-en"></textarea>
            </div>
            <div class="form-group">
                <label id="pest1-symptom-am-label">Symptoms (Amharic)</label>
                <textarea id="pest1-symptom-am"></textarea>
            </div>
            <div class="form-group">
                <label id="pest1-control-en-label">Control (English)</label>
                <textarea id="pest1-control-en"></textarea>
            </div>
            <div class="form-group">
                <label id="pest1-control-am-label">Control (Amharic)</label>
                <textarea id="pest1-control-am"></textarea>
            </div>

            <h3 id="harvesting-label">Harvesting</h3>
            <div class="form-group">
                <label id="harvest-en-label">Harvest Time (English)</label>
                <input type="text" id="harvest-en">
            </div>
            <div class="form-group">
                <label id="harvest-am-label">Harvest Time (Amharic)</label>
                <input type="text" id="harvest-am">
            </div>
            <div class="form-group">
                <label id="harvestmethod-en-label">Harvest Method (English)</label>
                <input type="text" id="harvestmethod-en">
            </div>
            <div class="form-group">
                <label id="harvestmethod-am-label">Harvest Method (Amharic)</label>
                <input type="text" id="harvestmethod-am">
            </div>
            <div class="form-group">
                <label id="yield-en-label">Expected Yield (English)</label>
                <input type="text" id="yield-en">
            </div>
            <div class="form-group">
                <label id="yield-am-label">Expected Yield (Amharic)</label>
                <input type="text" id="yield-am">
            </div>
            <div class="form-group">
                <label id="postharvest-en-label">Post-Harvest (English)</label>
                <input type="text" id="postharvest-en">
            </div>
            <div class="form-group">
                <label id="postharvest-am-label">Post-Harvest (Amharic)</label>
                <input type="text" id="postharvest-am">
            </div>

            <h3 id="pricing-info-label">Pricing Information</h3>
            <div class="form-group">
                <label id="price-en-market-label">Market Price (English)</label>
                <input type="text" id="price-en-market">
            </div>
            <div class="form-group">
                <label id="price-am-market-label">Market Price (Amharic)</label>
                <input type="text" id="price-am-market">
            </div>
            <div class="form-group">
                <label id="price-en-trend-label">Price Trend (English)</label>
                <input type="text" id="price-en-trend">
            </div>
            <div class="form-group">
                <label id="price-am-trend-label">Price Trend (Amharic)</label>
                <input type="text" id="price-am-trend">
            </div>
            <div class="form-group">
                <label id="price-en-demand-label">Market Demand (English)</label>
                <input type="text" id="price-en-demand">
            </div>
            <div class="form-group">
                <label id="price-am-demand-label">Market Demand (Amharic)</label>
                <input type="text" id="price-am-demand">
            </div>
            <div class="form-group">
                <label id="price-en-export-label">Export Potential (English)</label>
                <input type="text" id="price-en-export">
            </div>
            <div class="form-group">
                <label id="price-am-export-label">Export Potential (Amharic)</label>
                <input type="text" id="price-am-export">
            </div>

            <h3 id="recommendations-label">Expert Recommendations</h3>
            <div class="form-group">
                <label id="recommendation-en-label">Recommendations (English)</label>
                <textarea id="recommendation-en"></textarea>
            </div>
            <div class="form-group">
                <label id="recommendation-am-label">Recommendations (Amharic)</label>
                <textarea id="recommendation-am"></textarea>
            </div>
            
            <div class="form-actions">
                <button type="button" class="cancel-btn" id="cancel-btn"><span id="cancel-btn-text">Cancel</span></button>
                <button type="submit" class="save-btn" id="save-btn"><span id="save-btn-text">Save</span></button>
            </div>
        </form>
    </div>
</div>

<!-- Chatbot Container -->
<div class="chatbot-container">
    <button class="chatbot-toggle" id="chatbot-toggle">
        <i class="fas fa-robot"></i>
    </button>
    <div class="chatbot-window" id="chatbot-window">
        <div class="chatbot-header">
            <h3 id="chatbot-title">GET Crop Assistant</h3>
            <button class="chatbot-close" id="chatbot-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="chatbot-messages" id="chatbot-messages">
            <div class="message bot-message" id="chatbot-welcome">Hello! I'm your crop assistant. How can I help you today?</div>
        </div>
        <div class="chatbot-input">
            <input type="text" id="chatbot-input" placeholder="Type your message...">
            <button id="chatbot-send"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
</div>

<!-- FOOTER -->
<footer>
    <div class="footer-content">
        <div class="footer-column">
            <h3 id="about-get-crop-title">About GET Crop</h3>
            <p id="about-get-crop-text">Providing Ethiopian farmers with reliable agricultural information since 2023.</p>
        </div>
        <div class="footer-column">
            <h3 id="quick-links-title">Quick Links</h3>
            <ul class="footer-links">
                <li><a href="#" id="home-link">Home</a></li>
                <li><a href="#" id="about-link">About Us</a></li>
                <li><a href="#" id="feedback-link">Feedback</a></li>
                <li><a href="#" id="recommendations-link">Recommendations</a></li>
            </ul>
        </div>
        <div class="footer-column">
            <h3 id="contact-info-title">Contact Info</h3>
            <p><i class="fas fa-phone"></i> +251 934504257</p>
            <p><i class="fas fa-envelope"></i> info@getcropinfo.et</p>
        </div>
    </div>
    <div class="copyright">
        <p id="copyright-text">© 2025 GET Crop Info Tool. All rights reserved.</p>
    </div>
</footer>

<!-- SCRIPT -->
<script>
 // Database connection configuration
const DB_CONFIG = {
  apiBase: "http://localhost:5000/api"  // 👈 Update if backend port changes
};

  let crops = [];
  let currentLang = 'en';
  let currentCrop = null;
  let isAdmin = false;
  const ADMIN_PASSWORD = "admin123"; // Default admin password
  let userFeedback = JSON.parse(localStorage.getItem('userFeedback')) || [];
  let performanceChart = null;
  let appStats = JSON.parse(localStorage.getItem('appStats')) || {
    totalViews: 1243,
    totalDownloads: 328,
    recentActivities: []
  };

  // Mapping of crop names (EN) to default image URLs
  const cropImages = {
    "Teff": "https://tse3.mm.bing.net/th/id/OIP.bagJlLjoRWKI8iQQ8OvFrAHaE7?cb=thfvnext&rs=1&pid=ImgDetMain&o=7&rm=3",
    "Wheat": "https://esoullyf.in/cdn/shop/files/organic-bansi-wheat-1000x1000.jpg?v=1731066927&width=1445",
    "Barley": "https://domf5oio6qrcr.cloudfront.net/medialibrary/6159/ff717f2b-8a5b-4862-a65f-25b59e3f57b8.jpg",
    "Maize": "https://www.shutterstock.com/image-photo/corn-cobs-plantation-field-260nw-2219335147.jpg",
    "Sorghum": "https://www.thespruceeats.com/thmb/y1lPQxxTN2WdsV2RZKs6wzMNemE=/2151x0/filters:no_upscale():max_bytes(150000):strip_icc()/sayanjo65-a84ec4b764fd461f9ff7c0f83802b052.jpg",
    "Finger Millet": "https://tse4.mm.bing.net/th/id/OIP.-fpcvjaaUxKZm2Tu3Gw02gHaG-?cb=thfvnext&rs=1&pid=ImgDetMain&o=7&rm=3",
    "Rice": "https://th.bing.com/th/id/R.dd5f831389b773183330acaf9426ab9b?rik=ptmw%2bTI85Ocdqw&pid=ImgRaw&r=0",
    "Faba Bean": "https://www.gardenia.net/wp-content/uploads/2023/05/vicia-faba-fava-beans.webp",
    "Cowpea": "https://th.bing.com/th/id/R.2e8cda35c9f8970b246dec9b6767d30d?rik=%2bdH6GTWsRC9pbQ&pid=ImgRaw&r=0",
    "Niger Seed": "https://tse1.mm.bing.net/th/id/OIP.KkNsJ7JUjRCR15NwnrXCLAHaEU?cb=thfvnext&rs=1&pid=ImgDetMain&o=7&rm=3",
    "Safflower": "https://spiceography.com/wp-content/uploads/2020/09/7BA7A9B2-656A-44E7-BF64-6BF683265155-scaled.jpeg",
    "Mustard": "https://th.bing.com/th/id/R.4bc03baaf738beba8ee1ad7f77e8d424?rik=1Gj951cXO52umg&pid=ImgRaw&r=0",
    "Sesame": "https://tse1.mm.bing.net/th/id/OIP.i-JBCrsOkbIfO5wLBdFJaAHaE2?rs=1&pid=ImgDetMain&o=7&rm=3",
    "Linseed": "https://siwetatrading.com/wp-content/uploads/2021/09/Linseed-1024x768.jpg",
    "Rapeseed": "https://tse4.mm.bing.net/th/id/OIP.xgABE-1ZHf900p06hz5JyAAAAA?cb=thfvnext&rs=1&pid=ImgDetMain&o=7&rm=3",
    "Coffee": "https://images.pexels.com/photos/434213/pexels-photo-434213.jpeg?cs=srgb&dl=aroma-aromatic-art-434213.jpg&fm=jpg",
    "Mango":"https://tse4.mm.bing.net/th/id/OIP.mzUh6CqA-E00RSsJMN4V3QHaEO?rs=1&pid=ImgDetMain&o=7&rm=3",
     "Potato":"https://tse1.explicit.bing.net/th/id/OIP.8eUfqtYemN5xOaaHI_iSnwHaEK?rs=1&pid=ImgDetMain&o=7&rm=3",
    "Tomato":"https://tse3.mm.bing.net/th/id/OIP.UrI5dQxJID2vhH8OBO4iugHaE8?rs=1&pid=ImgDetMain&o=7&rm=3",
    "Groundnut":"https://tse1.explicit.bing.net/th/id/OIP.mK-qaXUTfjbf6vlc4pavdQHaE2?rs=1&pid=ImgDetMain&o=7&rm=3",
    "Fenugreek": "https://tse3.mm.bing.net/th/id/OIP.KNqc3dCSDYvpQK4aV-7VjgHaEK?cb=thfvnext&rs=1&pid=ImgDetMain&o=7&rm=3",
    "Lentil": "https://tse1.mm.bing.net/th/id/OIP.V3OPzEsPZcPi8ODL33jWIQHaHa?cb=thfvnext&rs=1&pid=ImgDetMain&o=7&rm=3"
  };

  // UI translations
  const translations = {
    en: {
      "welcome-title": "Welcome to GET Crop Info Tool",
      "welcome-text": "Select your role to continue",
      "user-title": "User",
      "user-description": "Browse crop information, search for specific crops, and learn about cultivation techniques.",
      "admin-title": "Administrator",
      "admin-description": "Manage crop database, add new crops, edit existing information, and maintain content.",
      "hero-title": "Empowering Farmers with Crop Knowledge",
      "hero-text": "Access comprehensive information about crop cultivation, diseases, and harvesting techniques in Ethiopia",
      "featured-crops-title": "Featured Crops",
      "recommendations-title": "Recommendations",
      "about-title": "About Us",
      "about-text-1": "GET Crop Info Tool is a comprehensive agricultural information platform designed specifically for Ethiopian farmers. Our mission is to provide accessible, accurate, and practical information to help farmers improve their crop yields and farming practices.",
      "about-text-2": "Developed in collaboration with agricultural experts from across Ethiopia, our database contains detailed information about the most important crops grown in the country, including traditional staples and cash crops.",
      "mission-title": "Our Mission",
      "mission-text": "To empower Ethiopian farmers with comprehensive, accessible, and accurate agricultural information that improves crop productivity, promotes sustainable farming practices, and enhances food security.",
      "vision-title": "Our Vision",
      "vision-text": "To become Ethiopia's leading digital agricultural resource, transforming traditional farming through technology and knowledge sharing to create a more food-secure and prosperous agricultural sector.",
      "goals-title": "Our Goals",
      "goal-1": "Provide detailed information on 50+ Ethiopian crops in both English and Amharic",
      "goal-2": "Reach over 100,000 farmers across all regions of Ethiopia",
      "goal-3": "Increase crop success rates by at least 25% through better information access",
      "goal-4": "Develop mobile applications for offline access in remote areas",
      "goal-5": "Establish partnerships with agricultural extension services nationwide",
      "contact-title": "Contact Us",
      "feedback-title": "Send Feedback",
      "feedback-name-label": "Your Name",
      "feedback-message-label": "Your Feedback",
      "submit-feedback-text": "Submit Feedback",
      "download-title": "Download Crop Information",
      "download-text": "Get all crop information for offline use in your preferred format",
      "no-results-text": "No crops found matching your search",
      "search-input": "Search for a crop...",
      "search-button-text": "Search",
      "theme-text": "Dark",
      "theme-text-light": "Light",
      "overview-tab-text": "Overview",
      "cultivation-tab-text": "Cultivation",
      "fertilizers-tab-text": "Fertilizers",
      "diseases-tab-text": "Diseases",
      "harvesting-tab-text": "Harvesting",
      "pricing-tab-text": "Pricing",
      "recommendations-tab-text": "Recommendations",
      "varieties-tab-text": "varieties",
      "planting-time-title": "Planting Time",
      "growing-period-title": "Growing Period",
      "climate-requirements-title": "Climate Requirements",
      "soil-type-title": "Soil Type",
      "water-requirements-title": "Water Requirements",
      "land-preparation-title": "Land Preparation",
      "planting-method-title": "Planting Method",
      "spacing-title": "Spacing",
      "irrigation-title": "Irrigation",
      "intercropping-title": "Intercropping",
      "weed-control-title": "Weed Control",
      "disease-control-title": "Disease Control",
      "pest-control-title": "Pest Control",
      "harvest-time-title": "Harvest Time",
      "harvest-method-title": "Harvesting Method",
      "yield-title": "Expected Yield",
      "post-harvest-title": "Post-Harvest Handling",
      "storage-title": "Storage",
      "market-price-title": "Market Price (per kg)",
      "price-trend-title": "Price Trend",
      "market-demand-title": "Market Demand",
      "export-potential-title": "Export Potential",
      "back-button-text": "Back",
      "back-to-selection-text": "Back to selection",
      "back-to-selection-text-rec": "Back to selection",
      "back-to-selection-text-login": "Back to selection",
      "back-to-selection-text-admin": "Back to selection",
      "phone-title": "Phone",
      "email-title": "Email",
      "address-title": "Address",
      "address-text": "Addis Ababa, Ethiopia",
      "quick-links-title": "Quick Links",
      "home-link": "Home",
      "all-crops-link": "All Crops",
      "recommendations-link": "Recommendations",
      "about-link": "About Us",
      "feedback-link": "Feedback",
      "contact-info-title": "Contact Info",
      "about-get-crop-title": "About GET Crop",
      "about-get-crop-text": "Providing Ethiopian farmers with reliable agricultural information since 2023.",
      "copyright-text": "© 2025 GET Crop Info Tool. All rights reserved.",
      "DAP": "DAP",
      "UREA": "UREA",
      "NPK": "NPK",
      "Organic": "Organic",
      "application-method": "Application Method",
      "bio_fertilizer": "bio_fertilizer",
      "user-button": "Continue as User",
      "admin-button": "Continue as Admin",
      "filter-options-title": "Filter Options",
      "altitude-filter-label": "Altitude (meters)",
      "rainfall-filter-label": "Rainfall (mm/year)",
      "soil-type-filter-label": "Soil Type",
      "season-filter-label": "Planting Season",
      "market-filter-label": "Market Purpose",
      "apply-filters-text": "Apply Filters",
      "admin-login-title": "Admin Login",
      "admin-password-label": "Password",
      "admin-cancel-text": "Cancel",
      "admin-login-text": "Login",
      "admin-dashboard-title": "Admin Dashboard",
      "refresh-crops-text": "Refresh",
      "admin-logout-text": "Logout",
      "dashboard-tab-text": "Dashboard",
      "crops-tab-text": "Crop Management",
      "feedback-tab-text": "User Feedback",
      "total-crops-label": "Total Crops",
      "total-views-label": "Total Views",
      "total-downloads-label": "Information Downloads",
      "total-feedback-label": "Feedback Items",
      "recent-activity-title": "Recent Activity",
      "manage-crops-title": "Manage Crops",
      "add-crop-text": "Add New Crop",
      "crop-name-header": "Name",
      "scientific-name-header": "Scientific Name",
      "date-added-header": "Date Added",
      "actions-header": "Actions",
      "user-feedback-title": "User Feedback",
      "feedback-name-header": "Name",
      "feedback-date-header": "Date",
      "feedback-message-header": "Feedback",
      "feedback-actions-header": "Actions",
      "name-en-label": "Name (English)",
      "name-am-label": "Name (Amharic)",
      "scientific-name-label": "Scientific Name",
      "crop-category-label": "Crop Category",
      "crop-varieties-label": "Crop Varieties (comma separated)",
      "varieties-label": "Crop varieties",
      "growing-time-label": "Growing Time (days)",
      "preferred-use-en-label": "Preferred Use (English)",
      "preferred-use-am-label": "Preferred Use (Amharic)",
      "disease-resistance-label": "Disease Resistance (comma separated)",
      "fertilizer-requirements-label": "Fertilizer Requirements",
      "image-upload-label": "Crop Image",
      "image-upload-text": "Drag & drop an image here or click to browse",
      "climate-requirements-label": "Climate Requirements",
      "temp-en-label": "Temperature (English)",
      "temp-am-label": "Temperature (Amharic)",
      "rainfall-en-label": "Rainfall (English)",
      "rainfall-am-label": "Rainfall (Amharic)",
      "altitude-en-label": "Altitude (English)",
      "altitude-am-label": "Altitude (Amharic)",
      "soil-requirements-label": "Soil Requirements",
      "soil-en-label": "Soil Type (English)",
      "soil-am-label": "Soil Type (Amharic)",
      "water-requirements-label": "Water Requirements",
      "water-en-label": "Water Needs (English)",
      "water-am-label": "Water Needs (Amharic)",
      "planting-info-label": "Planting Information",
      "planting-time-en-label": "Planting Time (English)",
      "planting-time-am-label": "Planting Time (Amharic)",
      "growing-period-en-label": "Growing Period (English)",
      "growing-period-am-label": "Growing Period (Amharic)",
      "cultivation-practices-label": "Cultivation Practices",
      "land-prep-en-label": "Land Preparation (English)",
      "land-prep-am-label": "Land Preparation (Amharic)",
      "planting-method-en-label": "Planting Method (English)",
      "planting-method-am-label": "Planting Method (Amharic)",
      "spacing-en-label": "Spacing (English)",
      "spacing-am-label": "Spacing (Amharic)",
      "irrigation-en-label": "Irrigation (English)",
      "irrigation-am-label": "Irrigation (Amharic)",
      "fertilizer-usage-label": "Fertilizer Usage",
      "dap-en-label": "DAP (English)",
      "dap-am-label": "DAP (Amharic)",
      "urea-en-label": "UREA (English)",
      "urea-am-label": "UREA (Amharic)",
      "dap-method-en-label": "DAP Application Method (English)",
      "dap-method-am-label": "DAP Application Method (Amharic)",
      "urea-method-en-label": "UREA Application Method (English)",
      "urea-method-am-label": "UREA Application Method (Amharic)",
      "crop-protection-label": "Crop Protection",
      "weed-en-label": "Weed Control (English)",
      "weed-am-label": "Weed Control (Amharic)",
      "disease-control-label": "Disease Control",
      "disease-name-en-label": "Disease Name (English)",
      "disease-name-am-label": "Disease Name (Amharic)",
      "disease-symptoms-en-label": "Symptoms (English)",
      "disease-symptoms-am-label": "Symptoms (Amharic)",
      "disease-prevention-en-label": "Prevention (English)",
      "disease-prevention-am-label": "Prevention (Amharic)",
      "disease-treatment-en-label": "Treatment (English)",
      "disease-treatment-am-label": "Treatment (Amharic)",
      "pest-en-label": "Pest Control (English)",
      "pest-am-label": "Pest Control (Amharic)",
      "harvesting-label": "Harvesting",
      "harvest-time-en-label": "Harvest Time (English)",
      "harvest-time-am-label": "Harvest Time (Amharic)",
      "harvest-method-en-label": "Harvest Method (English)",
      "harvest-method-am-label": "Harvest Method (Amharic)",
      "yield-en-label": "Expected Yield (English)",
      "yield-am-label": "Expected Yield (Amharic)",
      "post-harvest-en-label": "Post-Harvest (English)",
      "post-harvest-am-label": "Post-Harvest (Amharic)",
      "storage-en-label": "Storage (English)",
      "storage-am-label": "Storage (Amharic)",
      "pricing-info-label": "Pricing Information",
      "price-en-label": "Market Price (English)",
      "price-am-label": "Market Price (Amharic)",
      "price-trend-en-label": "Price Trend (English)",
      "price-trend-am-label": "Price Trend (Amharic)",
      "demand-en-label": "Market Demand (English)",
      "demand-am-label": "Market Demand (Amharic)",
      "export-en-label": "Export Potential (English)",
      "export-am-label": "Export Potential (Amharic)",
      "recommendations-label": "Expert Recommendations",
      "recommendations-en-label": "Recommendations (English)",
      "recommendations-am-label": "Recommendations (Amharic)",
      "cancel-btn-text": "Cancel",
      "save-btn-text": "Save",
      "chatbot-title": "GET Crop Assistant",
      "chatbot-welcome": "Hello! I'm your crop assistant. How can I help you today?",
      "menu-text": "Menu",
      "menu-feedback-text": "Feedback",
      "menu-recommendations-text": "Recommendations",
      "menu-about-text": "About Us",
      "menu-summary-graph-text": "Summary Graph",
      "summary-graph-title": "Crop Performance Analysis",
      "download-crop-excel-text": "Download Excel"
            
    },
    am: {
      "welcome-title": "ወደ ሰብል መረጃ መሣሪያ እንኳን በደህና መጡ",
      "welcome-text": "ለመቀጠር ሚናዎን ይምረጡ",
      "user-title": "ተጠቃሚ",
      "user-description": "የሰብል መረጃ ይመልከቱ፣ የተወሰኑ ሰብሎችን ይፈልጉ እና ስለ ልማት ቴክኒኮች ይማሩ።",
      "admin-title": "አስተዳዳሪ",
      "admin-description": "የሰብል መረጃ ጎታ ያስተዳድሩ፣ አዳዲስ ሰብሎች ያክሉ፣ ያሉትን መረጃ ያስተካክሉ እና ይጥፉ።",
      "hero-title": "ገበሬዎችን በሰብል እውቀት እድገት ማገዝ",
      "hero-text": "በኢትዮጵያ የሰብል ልማት፣ የበሽታ መከላከያ እና የመከር ቴክኒክ ዝርዝር መረጃ ያግኙ",
      "featured-crops-title": "የተመረጡ ሰብሎች",
      "recommendations-title": "ምክሮች",
      "about-title": "ስለ እኛ",
      "about-text-1": "ይሀ መረጃ መሣሪያ ለኢትዮጵያ ገበሬዎች የተዘጋጀ የሰብል መረጃ መድረክ ነው። ዋናው ዓላማችን ገበሬዎች የሰብል ምርታቸውን እና የእርሻ ልምዶቻቸውን እንዲያሻሽሉ ተደራሽ፣ ትክክለኛ እና ተግባራዊ መረጃ ማቅረብ ነው።",
      "about-text-2": "ተገቢ፣ የተረጋገጠ እና ተግባራዊ መረጃ በማቅረብ ገበሬዎች ምርታማነታቸውን እንዲያሳድጉ ያግዛል።በመላይ ኢትዮጵያ ካሉ የሰብል ባለሙያዎች ጋር በመተባበር የተዘጋጀው የእኛ መረጃ ማከማቻ በሀገሪቱ ውስጥ የሚመረቱ አስፈላጊ የሆኑ ሰብሎች ላይ ዝርዝር መረጃ ይዟል።",
      "mission-title": "ተልእኳችን",
      "mission-text": "ኢትዮጵያዊ ገበሬዎችን በሰፊ፣ ተደራሽ እና ትክክለኛ የግብርና መረጃ በማቅረብ የሰብል ምርታማነትን ለማሻሻል፣ አስቀጣይነት ያለው የእርሻ ልምዶችን ለማበረታታት እና የምግብ ዋስትናን ለማሻሻል ማገዝ።",
      "vision-title": "ራዕይ ሀሳባችን",
      "vision-text": "የኢትዮጵያ አቀፍ አምባሳደር ዲጂታል የግብርና ምንጭ በመሆን ባህላዊ እርሻን በቴክኖሎጂ እና በእውቀት አጋራትነት በመቀየር የበለጸገ የምግብ ዋስትና እና ተጠናቋይ የግብርና ምዘባ ለመፍጠር።",
      "goals-title": "ግቦቻችን",
      "goal-1": "በእንግሊዝኛ እና በአማርኛ በ50+ የኢትዮጵያ ሰብሎች ላይ ዝርዝር መረጃ መስጠት",
      "goal-2": "በኢትዮጵያ ሁሉም ክልሎች በሚገኙ ከ100,000 በላይ ገበሬዎች ላይ ማድረስ",
      "goal-3": "በተሻለ መረጃ አቅርቦት የሰብል ስኬት መጠን ቢያንስ 25% ማሳደግ",
      "goal-4": "ለሩቅ አካባቢዎች ከመስመር ውጭ አቅርቦት ሞባይል መተግበሪያዎችን ማዘጋጀት",
      "goal-5": "በመላው አገሪቱ ከግብርና ማስተዋወቂያ አገልግሎቶች ጋር አጋርነት ማቋቋም",
      "contact-title": "አግኙን",
      "feedback-title": "ግብረ መልስ ይላኩ",
      "feedback-name-label": "ስምዎ",
      "feedback-message-label": "ግብረ መልስዎ",
      "submit-feedback-text": "ግብረ መልስ ይላኩ",
      "download-title": "የሰብል መረጃ አውርድ",
      "download-text": "ለመስመር ውጭ አጠቃቀም የሁሉንም የሰብል መረጃ በተመረጠዎት ቅርጸት ያግኙ",
      "no-results-text": "ምንም የሚስማማ ሰብል አልተገኘም",
      "search-input": "ሰብል ፈልግ...",
      "search-button-text": "ፈልግ",
      "theme-text": "ጨለማ",
      "theme-text-light": "ብርሃን",
      "overview-tab-text": "አጠቃላይ እይታ",
      "cultivation-tab-text": "ልማት",
      "fertilizers-tab-text": "ማዳበሪያዎች",
      "diseases-tab-text": "በሽታዎች",
      "harvesting-tab-text": "ሰብል አሰባሰብ",
      "pricing-tab-text": "ዋጋ",
      "recommendations-tab-text": "ምክሮች",
      "varieties-tab-text": "ባህሪያት",
      "planting-time-title": "የመትከል ጊዜ",
      "growing-period-title": "የእድገት ጊዜ",
      "climate-requirements-title": "የአየር ንብረት መስፈርቶች",
      "soil-type-title": "የአፈር አይነት",
      "water-requirements-title": "የውሃ ፍላጎት",
      "land-preparation-title": "ምድር አዘገጃጀት",
      "planting-method-title": "የመትከያ ዘዴ",
      "spacing-title": "መካከለኛ ርቀት",
      "irrigation-title": "ማጠጣት",
      "intercropping-title": "ጋራ ማቋቋም",
      "weed-control-title": "የእፅ መቆጣጠሪያ",
      "disease-control-title": "የበሽታ መቆጣጠሪያ",
      "pest-control-title": "የአረም መቆጣጠሪያ",
      "harvest-time-title": "የሰብል አሰባሰብ ጊዜ",
      "harvest-method-title": "የአሰባሰብ ዘዴ",
      "yield-title": "የሚጠበቀ ምርት",
      "post-harvest-title": "ሰብል ከተሰበሰበ በኋላ አስተዳደር",
      "storage-title": "ማከማቻ",
      "market-price-title": "የገበያ ዋጋ (በኪ.ግ.)",
      "price-trend-title": "የዋጋ አዝማሚያ",
      "market-demand-title": "የገበያ ፍላጎት",
      "export-potential-title": "የማስለቀቅ አቅም",
      "back-button-text": "ተመለስ",
      "back-to-selection-text": "ወደ ምርጫ ተመለስ",
      "back-to-selection-text-rec": "ወደ ምርጫ ተመለስ",
      "back-to-selection-text-login": "ወደ ምርጫ ተመለስ",
      "back-to-selection-text-admin": "ወደ ምርጫ ተመለስ",
      "phone-title": "ስልክ",
      "email-title": "ኢሜይል",
      "address-title": "አድራሻ",
      "address-text": "አዲስ አበባ፣ ኢትዮጵያ",
      "quick-links-title": "ፈጣን አገናኞች",
      "home-link": "መነሻ",
      "all-crops-link": "ሁሉም ሰብሎች",
      "recommendations-link": "ምክሮች",
      "about-link": "ስለ እኛ",
      "feedback-link": "ግብረ መልስ",
      "contact-info-title": "የመገኛ መረጃ",
      "about-get-crop-title": "ስለ ሰብል መረጃ",
      "about-get-crop-text": "ከ2023 ጀምሮ ለኢትዮጵያዊ ገበሬዎች አስተማማኝ ግብርና መረጃ በመስጠት ላይ",
      "copyright-text": "© 2025 ስለ ሰብል መረጃ ሁሉም መብቶች የተጠበቁ ናቸው።",
      "DAP": "ዲ.ኤ.ፒ",
      "UREA": "ዩሪያ",
      "NPK": "ኤን.ፒ.ኬ",
      "Organic": "ኦርጋኒክ",
      "application-method": "የመተግበሪያ ዘዴ",
      "bio_fertilizer": "የተፈጥሮ ማዳበሪያ",
      "user-button": "እንደ ተጠቃሚ ይቀጥሉ",
      "admin-button": "እንደ አስተዳዳሪ ይቀጥሉ",
      "filter-options-title": "የማጣሪያ አማራጮች",
      "altitude-filter-label": "ከፍታ (ሜትር)",
      "rainfall-filter-label": "የዝናብ መጠን (ሚሜ/ዓመት)",
      "soil-type-filter-label": "የአፈር አይነት",
      "season-filter-label": "የመትከያ ወቅት",
      "market-filter-label": "የገበያ ዓላማ",
      "apply-filters-text": "ማጣሪያዎችን ይተግብሩ",
      "admin-login-title": "የአስተዳዳሪ መግቢያ",
      "admin-password-label": "የይለፍ ቃል",
      "admin-cancel-text": "ይቅር",
      "admin-login-text": "ግባ",
      "admin-dashboard-title": "የአስተዳዳሪ ዳሽቦርድ",
      "refresh-crops-text": "አድስ",
      "admin-logout-text": "ውጣ",
      "dashboard-tab-text": "ዳሽቦርድ",
      "crops-tab-text": "የሰብል አስተዳደር",
      "feedback-tab-text": "የተጠቃሚ ግብረ መልስ",
      "total-crops-label": "ጠቅላላ ሰብሎች",
      "total-views-label": "ጠቅላላ የታዩ",
      "total-downloads-label": "የመረጃ ማውረዶች",
      "total-feedback-label": "የግብረ መልስ እቃዎች",
      "recent-activity-title": "የቅርብ ሁኔታ",
      "manage-crops-title": "ሰብሎችን ያስተዳድሩ",
      "add-crop-text": "አዲስ ሰብል ያክሉ",
      "crop-name-header": "ስም",
      "scientific-name-header": "ሳይንሳዊ ስም",
      "date-added-header": "የታከለበት ቀን",
      "actions-header": "ድርጊቶች",
      "user-feedback-title": "የተጠቃሚ ግብረ መልስ",
      "feedback-name-header": "ስም",
      "feedback-date-header": "ቀን",
      "feedback-message-header": "ግብረ መልስ",
      "feedback-actions-header": "ድርጊቶች",
      "name-en-label": "ስም (እንግሊዝኛ)",
      "name-am-label": "ስም (አማርኛ)",
      "scientific-name-label": "ሳይንሳዊ ስም",
      "crop-category-label": "የሰብል ምድብ",
      "crop-varieties-label": "የሰብል ዝርያዎች (በኮማ የተለዩ)",
      "varieties-label": "የሰብል ባህሪያት",
      "growing-time-label": "የእድገት ጊዜ (ቀናት)",
      "preferred-use-en-label": "ተፈላጊ አጠቃቀም (እንግሊዝኛ)",
      "preferred-use-am-label": "ተፈላጊ አጠቃቀም (አማርኛ)",
      "disease-resistance-label": "የበሽታ መከላከል (በኮማ የተለዩ)",
      "fertilizer-requirements-label": "የማዳበሪያ መስፈርቶች",
      "image-upload-label": "የሰብል ምስል",
      "image-upload-text": "ምስል እዚህ ጋ ይጎትቱ ወይም ለመለጠፍ ይጫኑ",
      "climate-requirements-label": "የአየር ንብረት መስፈርቶች",
      "temp-en-label": "በሙቀት መጠን (እንግሊዝኛ)",
      "temp-am-label": "በሙቀት መጠን (አማርኛ)",
      "rainfall-en-label": "የዝናብ መጠን (እንግሊዝኛ)",
      "rainfall-am-label": "የዝናብ መጠን (አማርኛ)",
      "altitude-en-label": "ከፍታ (እንግሊዝኛ)",
      "altitude-am-label": "ከፍታ (አማርኛ)",
      "soil-requirements-label": "የአፈር መስፈርቶች",
      "soil-en-label": "የአፈር አይነት (እንግሊዝኛ)",
      "soil-am-label": "የአፈር አይነት (አማርኛ)",
      "water-requirements-label": "የውሃ መስፈርቶች",
      "water-en-label": "የውሃ ፍላጎት (እንግሊዝኛ)",
      "water-am-label": "የውሃ ፍላጎት (አማርኛ)",
      "planting-info-label": "የመትከያ መረጃ",
      "planting-time-en-label": "የመትከል ጊዜ (እንግሊዝኛ)",
      "planting-time-am-label": "የመትከል ጊዜ (አማርኛ)",
      "growing-period-en-label": "የእድገት ጊዜ (እንግሊዝኛ)",
      "growing-period-am-label": "የእድገት ጊዜ (አማርኛ)",
      "cultivation-practices-label": "የልማት ልምዶች",
      "land-prep-en-label": "ምድር አዘገጃጀት (እንግሊዝኛ)",
      "land-prep-am-label": "ምድር አዘገጃጀት (አማርኛ)",
      "planting-method-en-label": "የመትከያ ዘዴ (እንግሊዝኛ)",
      "planting-method-am-label": "የመትከያ ዘዴ (አማርኛ)",
      "spacing-en-label": "መካከለኛ ርቀት (እንግሊዝኛ)",
      "spacing-am-label": "መካከለኛ ርቀት (አማርኛ)",
      "irrigation-en-label": "ማጠጣት (እንግሊዝኛ)",
      "irrigation-am-label": "ማጠጣት (አማርኛ)",
      "fertilizer-usage-label": "የማዳበሪያ አጠቃቀም",
      "dap-en-label": "ዲ.ኤ.ፒ (እንግሊዝኛ)",
      "dap-am-label": "ዲ.ኤ.ፒ (አማርኛ)",
      "urea-en-label": "ዩሪያ (እንግሊዝኛ)",
      "urea-am-label": "ዩሪያ (አማርኛ)",
      "dap-method-en-label": "የዲ.ኤ.ፒ አተገባበር ዘዴ (እንግሊዝኛ)",
      "dap-method-am-label": "የዲ.ኤ.ፒ አተገባበር ዘዴ (አማርኛ)",
      "urea-method-en-label": "የዩሪያ አተገባበር ዘዴ (እንግሊዝኛ)",
      "urea-method-am-label": "የዩሪያ አተገባበር ዘዴ (አማርኛ)",
      "crop-protection-label": "የሰብል ጥበቃ",
      "weed-en-label": "የእፅ መቆጣጠሪያ (እንግሊዝኛ)",
      "weed-am-label": "የእፅ መቆጣጠሪያ (አማርኛ)",
      "disease-control-label": "የበሽታ መቆጣጠሪያ",
      "disease-name-en-label": "የበሽታ ስም (እንግሊዝኛ)",
      "disease-name-am-label": "የበሽታ ስም (አማርኛ)",
      "disease-symptoms-en-label": "ምልክቶች (እንግሊዝኛ)",
      "disease-symptoms-am-label": "ምልክቶች (አማርኛ)",
      "disease-prevention-en-label": "መከላከል (እንግሊዝኛ)",
      "disease-prevention-am-label": "መከላከል (አማርኛ)",
      "disease-treatment-en-label": "ህክምና (እንግሊዝኛ)",
      "disease-treatment-am-label": "ህክምና (አማርኛ)",
      "pest-en-label": "የአረም መቆጣጠሪያ (እንግሊዝኛ)",
      "pest-am-label": "የአረም መቆጣጠሪያ (አማርኛ)",
      "harvesting-label": "ማጨድ",
      "harvest-time-en-label": "የማጨድ ጊዜ (እንግሊዝኛ)",
      "harvest-time-am-label": "የማጨድ ጊዜ (አማርኛ)",
      "harvest-method-en-label": "የማጨድ ዘዴ (እንግሊዝኛ)",
      "harvest-method-am-label": "የማጨድ ዘዴ (አማርኛ)",
      "yield-en-label": "የሚጠበቀ ምርት (እንግሊዝኛ)",
      "yield-am-label": "የሚጠበቀ ምርት (አማርኛ)",
      "post-harvest-en-label": "ከመከር በኋላ (እንግሊዝኛ)",
      "post-harvest-am-label": "ከመከር በኋላ (አማርኛ)",
      "storage-en-label": "ማከማቻ (እንግሊዝኛ)",
      "storage-am-label": "ማከማቻ (አማርኛ)",
      "pricing-info-label": "የዋጋ መረጃ",
      "price-en-label": "የገበያ ዋጋ (እንግሊዝኛ)",
      "price-am-label": "የገበያ ዋጋ (አማርኛ)",
      "price-trend-en-label": "የዋጋ አዝማሚያ (እንግሊዝኛ)",
      "price-trend-am-label": "የዋጋ አዝማሚያ (አማርኛ)",
      "demand-en-label": "የገበያ ፍላጎት (እንግሊዝኛ)",
      "demand-am-label": "የገበያ ፍላጎት (አማርኛ)",
      "export-en-label": "የማስለቀቅ አቅም (እንግሊዝኛ)",
      "export-am-label": "የማስለቀቅ አቅም (አማርኛ)",
      "recommendations-label": "የባለሙያ ምክሮች",
      "recommendations-en-label": "ምክሮች (እንግሊዝኛ)",
      "recommendations-am-label": "ምክሮች (አማርኛ)",
      "cancel-btn-text": "ይቅር",
      "save-btn-text": "አስቀምጥ",
      "chatbot-title": "የሰብል ረዳት",
      "chatbot-welcome": "ሰላም! የእርስዎ የሰብል ረዳት ነኝ። ዛሬ እንዴት ልርዳችሁ?",
      "menu-text": "ምናሌ",
      "menu-feedback-text": "ግብረ መልስ",
      "menu-recommendations-text": "ምክሮች",
      "menu-about-text": "ስለ እኛ",
      "menu-summary-graph-text": "የማጠቃለያ ግራፍ",
      "summary-graph-title": "የሰብል አፈጻጸም ትንታኔ",
      "download-crop-excel-text": "Excel አውርድ"
    }
  };

  // DOM Elements
  const welcomeScreen = document.getElementById('welcome-screen');
  const homePage = document.getElementById('home-page');
  const cropDisplay = document.getElementById('crop-display');
  const feedbackPage = document.getElementById('feedback-page');
  const recommendationsPage = document.getElementById('recommendations-page');
  const aboutPage = document.getElementById('about-page');
  const summaryGraphPage = document.getElementById('summary-graph-page');
  const adminLoginPanel = document.getElementById('admin-login-panel');
  const adminPanel = document.getElementById('admin-panel');
  const backButton = document.getElementById('back-button');
  const searchInput = document.getElementById('search-input');
  const searchResults = document.getElementById('search-results');
  const noResultsMessage = document.getElementById('no-results-message');
  const featuredCrops = document.getElementById('featured-crops');
  const adminPasswordInput = document.getElementById('admin-password-input');
  const addCropBtn = document.getElementById('add-crop-btn');
  const cropsTableBody = document.getElementById('crops-table-body');
  const cropModal = document.getElementById('crop-modal');
  const modalTitle = document.getElementById('modal-title');
  const cropForm = document.getElementById('crop-form');
  const cancelBtn = document.getElementById('cancel-btn');
  const saveBtn = document.getElementById('save-btn');
  const modalClose = document.getElementById('modal-close');
  const backToSelectionUser = document.getElementById('back-to-selection-user');
  const backToSelectionLogin = document.getElementById('back-to-selection-login');
  const backToSelectionAdmin = document.getElementById('back-to-selection-admin');
  const backFromFeedback = document.getElementById('back-from-feedback');
  const backFromRecommendations = document.getElementById('back-from-recommendations');
  const backFromAbout = document.getElementById('back-from-about');
  const backFromSummaryGraph = document.getElementById('back-from-summary-graph');
  const submitFeedback = document.getElementById('submit-feedback');
  const downloadExcel = document.getElementById('download-excel');
  const downloadCropExcel = document.getElementById('download-crop-excel');
  const applyFilters = document.getElementById('apply-filters');
  const recommendationResults = document.getElementById('recommendation-results');
  const recentActivityList = document.getElementById('recent-activity-list');
  const feedbackTableBody = document.getElementById('feedback-table-body');
  const userButton = document.getElementById('user-button');
  const adminButton = document.getElementById('admin-button');
  const imageUploadContainer = document.getElementById('image-upload-container');
  const imageUploadInput = document.getElementById('image-upload-input');
  const imagePreview = document.getElementById('image-preview');
  const imageUploadText = document.getElementById('image-upload-text');
  const chatbotToggle = document.getElementById('chatbot-toggle');
  const chatbotWindow = document.getElementById('chatbot-window');
  const chatbotClose = document.getElementById('chatbot-close');
  const chatbotMessages = document.getElementById('chatbot-messages');
  const chatbotInput = document.getElementById('chatbot-input');
  const chatbotSend = document.getElementById('chatbot-send');
  const hamburgerMenu = document.getElementById('hamburger-menu');
  const hamburgerIcon = document.querySelector('.hamburger-icon');
  const hamburgerContent = document.querySelector('.hamburger-content');
  const menuFeedback = document.getElementById('menu-feedback');
  const menuRecommendations = document.getElementById('menu-recommendations');
  const menuAbout = document.getElementById('menu-about');
  const menuSummaryGraph = document.getElementById('menu-summary-graph');
  const cropCategories = document.getElementById('crop-categories');
  const categoryButtons = document.querySelectorAll('.category-btn');
  const updateChartBtn = document.getElementById('update-chart');

  function applyTranslations(lang) {
    Object.keys(translations[lang]).forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        if (id === "search-input" || id === "chatbot-input") {
          el.placeholder = translations[lang][id];
        } else {
          el.textContent = translations[lang][id];
        }
      }
    });
  }
  document.getElementById("add-variety-btn").addEventListener("click", function() {
  const container = document.getElementById("varieties-container");
  const newGroup = container.firstElementChild.cloneNode(true);

  // clear values in cloned inputs
  newGroup.querySelectorAll("input").forEach(input => input.value = "");

  container.appendChild(newGroup);
});

  // Database functions
  async function fetchCrops() {
    try {
      const response = await fetch(`${DB_CONFIG.apiBase}/crops`);
      
      if (!response.ok) {
        throw new Error('Failed to fetch crops');
      }
      
      const data = await response.json();
      return data;
    } catch (error) {
      console.error('Error fetching crops:', error);
      // Fallback to mock data if API fails
      return getMockCrops();
    }
  }

  // Mock data for demonstration
  function getMockCrops() {
    return [
      {
        _id: "1",
        name: { en: "Teff", am: "ጤፍ" },
        scientific: "Eragrostis tef",
        category: { en: "Cereals/Grains", am: "እህል እና ጥራጥሬ" },
        image: "https://tse3.mm.bing.net/th/id/OIP.bagJlLjoRWKI8iQQ8OvFrAHaE7?cb=thfvnext&rs=1&pid=ImgDetMain&o=7&rm=3",
        views: 150,
        overview: {
          plantingTime: { en: "June - July", am: "ጁን - ጁላይ" },
          growingPeriod: { en: "90-120 days", am: "90-120 ቀናት" },
          climateRequirements: { en: "Warm, moderate rainfall", am: "ሞቅ ያለ፣ መጠነኛ ዝናብ" },
          soilType: { en: "Well-drained loam", am: "የሚፈሳ ሸለቆ" }
        },
        cultivation: {
          landPrep: { en: "Plow and harrow thoroughly", am: "ደንብ በሆነ መልኩ ማርስ እና ማጠር" },
          plantingMethod: { en: "Broadcast seeding", am: "ስፋት በሆነ መልኩ መትከል" },
          spacing: { en: "Broadcast method", am: "ስፋት በሆነ ዘዴ" },
          waterRequirements: { en: "Moderate", am: "መጠነኛ" }
        },
        fertilizers: [
          {
            type: { en: "DAP", am: "ዲኤፒ" },
            application: { en: "Apply 100-150 kg/ha at planting", am: "100-150 ኪ.ግ/ሄክታር በመትከል ጊዜ ይተግብሩ" },
            benefits: { en: "Provides phosphorus for root development", am: "ለስር እድገት ፎስፈረስ ያቀርባል" }
          }
        ],
        diseases: [
          {
            name: { en: "Rust", am: "ቢላታ" },
            symptoms: { en: "Orange-brown pustules on leaves", am: "ብርቱካናማ ነጥቦች በቅጠሎች ላይ" },
            control: { en: "Use resistant varieties and fungicides", am: "በበሽታ የማይጎዱ ዝርያዎችን እና ፈንገስ መትከያዎችን ይጠቀሙ" }
          }
        ],
        pests: [
          {
            name: { en: "Aphids", am: "ፋፍላዎች" },
            symptoms: { en: "Curling leaves, stunted growth", am: "የተጠቀለሉ ቅጠሎች፣ የተከለከለ እድገት" },
            control: { en: "Use insecticidal soap or neem oil", am: "የንቦች ማጥረጫ ሳሙና ወይም ኒም ዘይት ይጠቀሙ" }
          }
        ],
        harvesting: {
          harvestTime: { en: "September - October", am: "ሴፕቴምበር - ኦክቶበር" },
          harvestMethod: { en: "Cut with sickle", am: "በአሰር መቁረጥ" },
          yieldPotential: { en: "1-2 tons/ha", am: "1-2 ቶን/ሄክታር" },
          postHarvest: { en: "Thresh and winnow", am: "ማጨድ እና ማንጠፍ" }
        },
        price: {
          en: {
            "Market Price": "50-70 ETB/kg",
            "Price Trend": "Stable",
            "Market Demand": "High",
            "Export Potential": "High"
          },
          am: {
            "Market Price": "50-70 ብር/ኪ.ግ.",
            "Price Trend": "ቋሚ",
            "Market Demand": "ከፍተኛ",
            "Export Potential": "ከፍተኛ"
          }
        },
        recommendation: {
          en: "Teff is a staple crop in Ethiopia with high nutritional value. It's well-suited for most regions.",
          am: "ጤፍ በኢትዮጵያ ውስጥ መሠረታዊ ሰብል ሲሆን ከፍተኛ የምግብ እሴት አለው። ለአብዛኛዎቹ ክልሎች ተስማሚ ነው።"
        },
        varieties: [
          {
            name: { en: "DZ-Cr-387", am: "ዲዚ-ሲአር-387" },
            characteristics: {
              growing_time_days: 110,
              preferred_use: { en: "Injera making", am: "እንጀራ ለመስራት" },
              disease_resistance: { en: "Rust resistant", am: "በቢላታ የማይጎድ" },
              fertilizer_requirements: { en: "Medium", am: "መጠነኛ" }
            }
          }
        ]
      }
    ];
  }

  // Initialize the application
  function initApp() {
    // Load crops data
    loadCrops();
    
    // Set up event listeners
    setupEventListeners();
    
    // Apply initial translations
    applyTranslations(currentLang);
    
    // Update stats
    updateStats();
  }

  // Load crops from database or mock data
  async function loadCrops() {
    try {
        const res = await fetch(`${DB_CONFIG.apiBase}/crops`);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        crops = await res.json();

        // If no crops from API, use mock data
        if (!crops || crops.length === 0) {
          crops = getMockCrops();
        }

        // Render featured and admin table
        const featuredContainer = document.getElementById("featured-crops");
        if (!featuredContainer) return;
        featuredContainer.innerHTML = "";

        if (Array.isArray(crops)) {
            crops.forEach(crop => {
                const card = document.createElement("div");
                card.className = "crop-card";
                card.setAttribute('data-id', crop._id);
                
                // FIX: Use the crop's image property directly
                const imageUrl = crop.image || cropImages[crop.name?.en] || 'https://via.placeholder.com/150';

                card.innerHTML = `
                    <img src="${imageUrl}" alt="${crop.name?.en || 'Crop'}" onerror="this.src='https://via.placeholder.com/150'">
                    <div class="crop-card-content">
                        <h3>${crop.name?.[currentLang] || crop.name?.en || 'Unnamed Crop'}</h3>
                        <p><em>${crop.scientific || 'N/A'}</em></p>
                        <p><strong>${currentLang === 'en' ? 'Category' : 'ምድብ'}:</strong> ${crop.category?.[currentLang] || crop.category?.en || 'N/A'}</p>
                    </div>
                `;
                
                // CRITICAL FIX: Pass the specific `crop` object to displayCrop
                // by wrapping it in an arrow function.
                card.addEventListener("click", () => {
                  // Track view count
                  if (!crop.views) crop.views = 0;
                  crop.views++;
                  updateStats();
                  displayCrop(crop);
                });
                
                featuredContainer.appendChild(card);
            });

            if (isAdmin) {
                updateStats();
                populateCropsTable();
            }

        } else {
            featuredContainer.innerHTML = `<p>${currentLang === 'en' ? 'Error: No crops to display.' : 'ስህተት፡ ምንም ሰብሎች አልተገኙም።'}</p>`;
        }
    } catch (err) {
        console.error("Error loading crops:", err);
        crops = getMockCrops();
        const featuredContainer = document.getElementById("featured-crops");
        if (featuredContainer) featuredContainer.innerHTML = `<p>${currentLang === 'en' ? 'Failed to load crops. Check server & network.' : 'ሰብሎችን ማምጫት አልተቻለም።'}</p>`;
    }
}

document.addEventListener("DOMContentLoaded", loadCrops);

  // Display featured crops on the home page
function displayFeaturedCrops() {
  const featuredCrops = document.getElementById("featured-crops");
  featuredCrops.innerHTML = '';

  // Get active category
  const activeCategoryBtn = document.querySelector('.category-btn.active');
  const activeCategoryEn = activeCategoryBtn?.dataset.categoryEn || 'all';
  const activeCategoryAm = activeCategoryBtn?.dataset.categoryAm || 'ሁሉም';

  // Filter crops by category if not "all"
  let filteredCrops = crops;
  if (activeCategoryEn !== 'all') {
    filteredCrops = crops.filter(crop => {
      const cropCategoryEn = crop.category?.en || '';
      const cropCategoryAm = crop.category?.am || '';
      
      // Check both English and Amharic category names
      return cropCategoryEn.toLowerCase() === activeCategoryEn.toLowerCase() || 
             cropCategoryAm === activeCategoryAm;
    });
  }

  if (filteredCrops.length === 0) {
    featuredCrops.innerHTML = `<p>${
      currentLang === 'en'
        ? 'No crops found in this category.'
        : 'በዚህ ምድብ ውስጥ ምንም ሰብሎች አልተገኙም።'
    }</p>`;
    return;
  }

  // ✅ Show ALL crops in this category
  filteredCrops.forEach(crop => {
    const cropCard = document.createElement('div');
    cropCard.className = 'crop-card';
    cropCard.setAttribute('data-id', crop._id);

    cropCard.innerHTML = `
      <img src="${crop.image || cropImages[crop.name?.en] || 'https://via.placeholder.com/300x200?text=No+Image'}" 
           alt="${crop.name?.[currentLang] || 'Crop'}" 
           onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
      <div class="crop-card-content">
        <h3>${crop.name?.[currentLang] || crop.name?.en || (currentLang === 'en' ? "Unnamed Crop" : "ስም የሌለው ሰብል")}</h3>
        <p><em>${crop.scientific || "N/A"}</em></p>
        <p><strong>${currentLang === 'en' ? 'Category' : 'ምድብ'}:</strong> 
           ${crop.category?.[currentLang] || crop.category?.en || "N/A"}</p>
      </div>
    `;

    cropCard.addEventListener("click", () => {
      if (!crop.views) crop.views = 0;
      crop.views++;
      updateStats();
      displayCrop(crop);
    });

    featuredCrops.appendChild(cropCard);
  });
}


  // Create performance chart for crops
  function createPerformanceChart() {
    const ctx = document.getElementById('performance-chart').getContext('2d');
    
    // Destroy previous chart if it exists
    if (performanceChart) {
      performanceChart.destroy();
    }
    
    // Get chart options
    const chartType = document.getElementById('chart-type-filter').value;
    const categoryFilter = document.getElementById('category-filter').value;
    const metricFilter = document.getElementById('metric-filter').value;
    
    // Filter crops by category if needed
    let filteredCrops = [...crops];
    if (categoryFilter !== 'all') {
      filteredCrops = crops.filter(crop => {
        const cropCategory = crop.category?.en || '';
        return cropCategory.toLowerCase().includes(categoryFilter.toLowerCase());
      });
    }
    
    // Sort crops by selected metric
    const sortedCrops = filteredCrops.sort((a, b) => {
      // Calculate performance score based on selected metric
      const scoreA = calculatePerformanceScore(a, metricFilter);
      const scoreB = calculatePerformanceScore(b, metricFilter);
      return scoreB - scoreA;
    });
    
    // Get top 10 crops for the chart
    const chartData = sortedCrops.slice(0, 10);
    
    // Create new chart
    performanceChart = new Chart(ctx, {
      type: chartType,
      data: {
        labels: chartData.map(crop => crop.name[currentLang]),
        datasets: [{
          label: getMetricLabel(metricFilter, currentLang),
          data: chartData.map(crop => calculatePerformanceScore(crop, metricFilter)),
          backgroundColor: '#4CAF50',
          borderColor: '#388E3C',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: chartType !== 'radar' ? {
          y: {
            beginAtZero: true,
            max: 100,
            title: {
              display: true,
              text: getMetricLabel(metricFilter, currentLang)
            }
          },
          x: {
            title: {
              display: true,
              text: currentLang === 'en' ? 'Crops' : 'ሰብሎች'
            }
          }
        } : {},
        plugins: {
          title: {
            display: true,
            text: getChartTitle(metricFilter, currentLang)
          }
        }
      }
    });
  }

  // Calculate performance score based on metric
  function calculatePerformanceScore(crop, metric) {
    let score = 50; // Base score
    
    switch(metric) {
      case 'yield':
        // Analyze yield potential
        const yieldText = crop.harvesting?.yieldPotential?.en || '';
        if (yieldText.includes('high') || yieldText.includes('>') || yieldText.match(/\d+\+/) || yieldText.match(/\d+\s*tons/)) {
          score += 30;
        } else if (yieldText.includes('medium') || yieldText.includes('moderate')) {
          score += 15;
        }
        break;
        
      case 'disease':
        // Analyze disease resistance
        if (crop.diseases && crop.diseases.length > 0) {
          const diseaseText = crop.diseases[0]?.control?.en || '';
          if (diseaseText.includes('resistant') || diseaseText.includes('prevent') || diseaseText.includes('control')) {
            score += 30;
          }
        }
        
        // Check varieties for disease resistance
        if (crop.varieties && crop.varieties.length > 0) {
          const variety = crop.varieties[0];
          const resistanceText = variety.characteristics?.disease_resistance?.en || '';
          if (resistanceText.includes('resistant') || resistanceText.includes('tolerant')) {
            score += 20;
          }
        }
        break;
        
      case 'market':
        // Analyze market value
        const priceText = crop.price?.en?.["Market Price"] || '';
        const demandText = crop.price?.en?.["Market Demand"] || '';
        const exportText = crop.price?.en?.["Export Potential"] || '';
        
        if (priceText.includes('high') || priceText.match(/\d+\s*ETB/) || priceText.match(/\d+\s*birr/)) {
          score += 20;
        }
        
        if (demandText.includes('high') || demandText.includes('strong')) {
          score += 20;
        }
        
        if (exportText.includes('high') || exportText.includes('good')) {
          score += 10;
        }
        break;
    }
    
    return Math.min(score, 100); // Cap at 100
  }

  // Get metric label based on language
  function getMetricLabel(metric, lang) {
    const labels = {
      en: {
        yield: 'Yield Performance Score',
        disease: 'Disease Resistance Score',
        market: 'Market Value Score'
      },
      am: {
        yield: 'የምርት አፈጻጸም ነጥብ',
        disease: 'የበሽታ መከላከል ነጥብ',
        market: 'የገበያ ዋጋ ነጥብ'
      }
    };
    
    return labels[lang][metric] || 'Performance Score';
  }

  // Get chart title based on metric
  function getChartTitle(metric, lang) {
    const titles = {
      en: {
        yield: 'Crop Yield Performance Analysis',
        disease: 'Crop Disease Resistance Analysis',
        market: 'Crop Market Value Analysis'
      },
      am: {
        yield: 'የሰብል ምርት አፈጻጸም ትንታኔ',
        disease: 'የሰብል በሽታ መከላከል ትንታኔ',
        market: 'የሰብል ገበያ ዋጋ ትንታኔ'
      }
    };
    
    return titles[lang][metric] || 'Crop Performance Analysis';
  }

  // Display crop details
  // ✅ Fixed function to display crop details fully, including fertilizers, diseases, pests, varieties
// ✅ Fixed function to display crop details fully, including fertilizers, diseases, pests, varieties
// Replace your existing displayCrop(...) with this full function
function displayCrop(crop) {
  console.log("displayCrop called with:", crop);

  const homePage = document.getElementById("home-page");
  const cropDisplay = document.getElementById("crop-display");
  if (homePage) homePage.style.display = "none";
  if (cropDisplay) cropDisplay.style.display = "block";

  if (!crop || !crop.name) {
    console.error("Invalid crop object passed to displayCrop:", crop);
    document.getElementById("crop-name").textContent =
      currentLang === "en" ? "Information not found" : "መረጃ አልተገኘም";
    return;
  }

  // keep reference
  currentCrop = crop;

  // --- Header ---
  document.getElementById("crop-image").src =
    crop.image || cropImages?.[crop.name?.en] || "https://via.placeholder.com/300x200?text=No+Image";

  document.getElementById("crop-name").textContent =
    crop.name?.[currentLang] || crop.name?.en ||
    (currentLang === "en" ? "Unnamed Crop" : "ስም የሌለው ሰብል");

  document.getElementById("crop-scientific").textContent = crop.scientific || "N/A";

  // --- Overview ---
  document.getElementById("planting-time").textContent =
    crop.overview?.plantingTime?.[currentLang] || "N/A";

  document.getElementById("growing-period").textContent =
    crop.overview?.growingPeriod?.[currentLang] || "N/A";

  document.getElementById("climate-requirements").textContent =
    crop.overview?.climateRequirements?.[currentLang] || "N/A";

  document.getElementById("soil-type").textContent =
    crop.overview?.soilType?.[currentLang] || "N/A";

  document.getElementById("water-requirements").textContent =
    crop.cultivation?.waterRequirements?.[currentLang] || "N/A";

  // --- Cultivation ---
  document.getElementById("land-preparation").textContent =
    crop.cultivation?.landPrep?.[currentLang] || "N/A";

  document.getElementById("planting-method").textContent =
    crop.cultivation?.plantingMethod?.[currentLang] || "N/A";

  document.getElementById("spacing").textContent =
    crop.cultivation?.spacing?.[currentLang] || "N/A";

  // --- Fertilizers (ROBUST) ---
  // --- Fertilizers ---
const fertilizersList = document.getElementById("fertilizers-list");
fertilizersList.innerHTML = "";

let ferts = crop.fertilizers;
if (ferts && !Array.isArray(ferts)) {
  ferts = [ferts];
}

// merge with variety + alt keys like before...
const entries = [];
if (Array.isArray(ferts)) entries.push(...ferts);

// also variety-level fertilizer info
if (Array.isArray(crop.varieties)) {
  crop.varieties.forEach(v => {
    const fr = v.characteristics?.fertilizer_requirements;
    if (fr) {
      entries.push({
        type: v.name?.[currentLang] || v.name?.en || "Variety",
        application: fr
      });
    }
  });
}

// filter out empty objects
const cleanEntries = entries.filter(f =>
  typeof f === "string" ||
  (f && (f.type || f.application || f.benefits))
);

if (cleanEntries.length > 0) {
  cleanEntries.forEach((fert, idx) => {
    let type = (typeof fert === 'object') ? (fert.type?.[currentLang] || fert.type?.en || fert.type) : null;
    let application = (typeof fert === 'object') ? (fert.application?.[currentLang] || fert.application?.en || fert.application) : null;
    let benefits = (typeof fert === 'object') ? (fert.benefits?.[currentLang] || fert.benefits?.en || fert.benefits) : null;

    if (!type && typeof fert === 'string') {
      application = fert;
      type = currentLang === 'en' ? `Fertilizer ${idx+1}` : `ማዳበሪያ ${idx+1}`;
    }

    if (!type) type = currentLang === 'en' ? 'Fertilizer' : 'ማዳበሪያ';

    const item = document.createElement("div");
    item.className = "fertilizer-item";
    item.innerHTML = `
      <h4>${type}</h4>
      <p><strong>${currentLang === "en" ? "Application" : "አተገባበር"}:</strong> ${application || "N/A"}</p>
      ${benefits ? `<p><strong>${currentLang === "en" ? "Benefits" : "ጥቅሞች"}:</strong> ${benefits}</p>` : ""}
    `;
    fertilizersList.appendChild(item);
  });
} else {
  fertilizersList.innerHTML = `<p>${currentLang === "en" ? "No fertilizer information available." : "የማዳበሪያ መረጃ አልተገኘም።"}</p>`;
}


  // --- Diseases (render ALL) ---
  const diseasesList = document.getElementById("diseases-list");
  diseasesList.innerHTML = "";
  if (Array.isArray(crop.diseases) && crop.diseases.length > 0) {
    crop.diseases.forEach(disease => {
      const node = document.createElement("div");
      node.className = "disease-item";
      node.innerHTML = `
        <h4>${disease.name?.[currentLang] || disease.name?.en || "N/A"}</h4>
        <p><strong>${currentLang === "en" ? "Symptoms" : "ምልክቶች"}:</strong> ${disease.symptoms?.[currentLang] || disease.symptoms?.en || "N/A"}</p>
        <p><strong>${currentLang === "en" ? "Control" : "መቆጣጠሪያ"}:</strong> ${disease.control?.[currentLang] || disease.control?.en || "N/A"}</p>
      `;
      diseasesList.appendChild(node);
    });
  } else {
    diseasesList.innerHTML = `<p>${currentLang === "en" ? "No disease information available." : "የበሽታ መረጃ አልተገኘም።"}</p>`;
  }

  // --- Pests (render ALL) ---
  const pestList = document.getElementById("pest-control-list");
  pestList.innerHTML = "";
  if (Array.isArray(crop.pests) && crop.pests.length > 0) {
    crop.pests.forEach(pest => {
      const node = document.createElement("div");
      node.className = "disease-item";
      node.innerHTML = `
        <h4>${pest.name?.[currentLang] || pest.name?.en || "N/A"}</h4>
        <p><strong>${currentLang === "en" ? "Symptoms" : "ምልክቶች"}:</strong> ${pest.symptoms?.[currentLang] || pest.symptoms?.en || "N/A"}</p>
        <p><strong>${currentLang === "en" ? "Control" : "መቆጣጠሪያ"}:</strong> ${pest.control?.[currentLang] || pest.control?.en || "N/A"}</p>
      `;
      pestList.appendChild(node);
    });
  } else {
    pestList.innerHTML = `<p>${currentLang === "en" ? "No pest information available." : "የተባይ መረጃ አልተገኘም።"}</p>`;
  }

  // --- Harvesting ---
  document.getElementById("harvest-time").textContent =
    crop.harvesting?.harvestTime?.[currentLang] || "N/A";

  document.getElementById("harvest-method").textContent =
    crop.harvesting?.harvestMethod?.[currentLang] || "N/A";

  document.getElementById("yield").textContent =
    crop.harvesting?.yieldPotential?.[currentLang] || "N/A";

  document.getElementById("post-harvest").textContent =
    crop.harvesting?.postHarvest?.[currentLang] || "N/A";

  // --- Pricing ---
  document.getElementById("market-price").textContent =
    crop.price?.[currentLang]?.["Market Price"] || crop.price?.[currentLang]?.price || "N/A";

  document.getElementById("price-trend").textContent =
    crop.price?.[currentLang]?.["Price Trend"] || "N/A";

  document.getElementById("market-demand").textContent =
    crop.price?.[currentLang]?.["Market Demand"] || "N/A";

  document.getElementById("export-potential").textContent =
    crop.price?.[currentLang]?.["Export Potential"] || "N/A";

  // --- Recommendations ---
  const recommendationsList = document.getElementById("crop-recommendations-list");
  recommendationsList.innerHTML = `<p>${
    crop.recommendation?.[currentLang] ||
    crop.recommendation?.en ||
    (currentLang === "en" ? "No recommendations available." : "ምክሮች አልተገኙም።")
  }</p>`;

  // --- Varieties ---
  const varietiesList = document.getElementById("varieties-list");
  varietiesList.innerHTML = "";
  if (Array.isArray(crop.varieties) && crop.varieties.length > 0) {
    crop.varieties.forEach(variety => {
      const item = document.createElement("div");
      item.className = "info-item";
      item.innerHTML = `
        <h4>${variety.name?.[currentLang] || variety.name?.en || "N/A"}</h4>
        <div class="info-title">${currentLang === "en" ? "Growing Time" : "የእድገት ጊዜ"}</div>
        <p>${variety.characteristics?.growing_time_days || "N/A"} ${currentLang === "en" ? "days" : "ቀናት"}</p>
        <div class="info-title">${currentLang === "en" ? "Preferred Use" : "ተፈላጊ አጠቃቀም"}</div>
        <p>${variety.characteristics?.preferred_use?.[currentLang] || variety.characteristics?.preferred_use?.en || "N/A"}</p>
        <div class="info-title">${currentLang === "en" ? "Disease Resistance" : "የበሽታ መከላከል"}</div>
        <p>${variety.characteristics?.disease_resistance?.[currentLang] || variety.characteristics?.disease_resistance?.en || "N/A"}</p>
        <div class="info-title">${currentLang === "en" ? "Fertilizer Requirements" : "የማዳበሪያ መስፈርቶች"}</div>
        <p>${variety.characteristics?.fertilizer_requirements?.[currentLang] || variety.characteristics?.fertilizer_requirements?.en || variety.characteristics?.fertilizer_requirements || "N/A"}</p>
      `;
      varietiesList.appendChild(item);
    });
  } else {
    varietiesList.innerHTML = `<p>${currentLang === "en" ? "No varieties information available." : "የዝርያ መረጃ አልተገኘም።"}</p>`;
  }
}




  // Set up all event listeners
  function setupEventListeners() {
    // Theme toggle
    document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
    
    // Language selection
    document.querySelectorAll('.language-options a').forEach(option => {
      option.addEventListener('click', (e) => {
        e.preventDefault();
        const lang = e.target.getAttribute('data-lang');
        changeLanguage(lang);
      });
    });
    
    // User selection
    userButton.addEventListener('click', () => {
      welcomeScreen.style.display = 'none';
      homePage.style.display = 'block';
    });
    
    adminButton.addEventListener('click', () => {
      welcomeScreen.style.display = 'none';
      adminLoginPanel.style.display = 'block';
    });
    
    // Back to selection buttons
    backToSelectionUser.addEventListener('click', backToSelection);
    backToSelectionLogin.addEventListener('click', backToSelection);
    backToSelectionAdmin.addEventListener('click', backToSelection);
    
    // Back buttons from different pages
    backFromFeedback.addEventListener('click', () => {
      feedbackPage.style.display = 'none';
      homePage.style.display = 'block';
    });
    
    backFromRecommendations.addEventListener('click', () => {
      recommendationsPage.style.display = 'none';
      homePage.style.display = 'block';
    });
    
    backFromAbout.addEventListener('click', () => {
      aboutPage.style.display = 'none';
      homePage.style.display = 'block';
    });
    
    backFromSummaryGraph.addEventListener('click', () => {
      summaryGraphPage.style.display = 'none';
      homePage.style.display = 'block';
    });
    
    // Back button from crop display
    backButton.addEventListener('click', () => {
      cropDisplay.style.display = 'none';
      homePage.style.display = 'block';
    });
    
    // Crop tabs
    document.querySelectorAll('.crop-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        // Remove active class from all tabs
        document.querySelectorAll('.crop-tab').forEach(t => t.classList.remove('active'));
        // Add active class to clicked tab
        tab.classList.add('active');
        
        // Hide all tab content
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        // Show the corresponding tab content
        const tabName = tab.getAttribute('data-tab');
        document.getElementById(`${tabName}-tab`).classList.add('active');
      });
    });
    
    // Admin tabs
    document.querySelectorAll('.admin-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        // Remove active class from all tabs
        document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
        // Add active class to clicked tab
        tab.classList.add('active');
        
        // Hide all tab content
        document.querySelectorAll('.admin-tab-content').forEach(content => content.classList.remove('active'));
        // Show the corresponding tab content
        const tabName = tab.getAttribute('data-tab');
        document.getElementById(`${tabName}-tab`).classList.add('active');
      });
    });
    
    // Search functionality
    document.getElementById('search-button').addEventListener('click', performSearch);
    document.getElementById('search-input').addEventListener('input', performSearch);
    document.getElementById('search-input').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        performSearch();
      }
    });
    
    // Admin login
    document.getElementById('admin-login-submit').addEventListener('click', adminLogin);
    document.getElementById('admin-login-cancel').addEventListener('click', backToSelection);
    
    // Admin logout
    document.getElementById('admin-logout-button').addEventListener('click', adminLogout);
    
    // Add crop button
    addCropBtn.addEventListener('click', () => {
      openCropModal();
    });
    
    // Modal close buttons
    modalClose.addEventListener('click', closeCropModal);
    cancelBtn.addEventListener('click', closeCropModal);
    
    // Save crop form
    cropForm.addEventListener('submit', saveCrop);
    
    // Chatbot functionality
    chatbotToggle.addEventListener('click', toggleChatbot);
    chatbotClose.addEventListener('click', toggleChatbot);
    chatbotSend.addEventListener('click', sendChatMessage);
    chatbotInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        sendChatMessage();
      }
    });
    
    // Feedback submission
    submitFeedback.addEventListener('click', submitFeedbackForm);
    
    // Download buttons - Only Excel
    downloadExcel.addEventListener('click', downloadAsExcel);
    downloadCropExcel.addEventListener('click', downloadCropAsExcel);
    
    // Recommendation filters
    applyFilters.addEventListener('click', applyRecommendationFilters);
    
    // Hamburger menu functionality - FIXED
    hamburgerIcon.addEventListener('click', (e) => {
      e.stopPropagation();
      hamburgerMenu.classList.toggle('active');
    });
    
    // Close hamburger menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!hamburgerMenu.contains(e.target)) {
        hamburgerMenu.classList.remove('active');
      }
    });
    
    // Listen for clicks on crop cards
    document.addEventListener('click', (e) => {
      const card = e.target.closest('.crop-card');
      if (!card) return;

      const cropId = card.getAttribute('data-id');
      const crop = crops.find(c => c._id === cropId);
      
      if (crop) {
        // Track view count
        if (!crop.views) crop.views = 0;
        crop.views++;
        updateStats();
        displayCrop(crop);
      }
    });
    
    // Hamburger menu items
    menuFeedback.addEventListener('click', (e) => {
      e.preventDefault();
      homePage.style.display = 'none';
      feedbackPage.style.display = 'block';
      hamburgerMenu.classList.remove('active');
    });
    
    menuRecommendations.addEventListener('click', (e) => {
      e.preventDefault();
      homePage.style.display = 'none';
      recommendationsPage.style.display = 'block';
      hamburgerMenu.classList.remove('active');
    });
    
    menuAbout.addEventListener('click', (e) => {
      e.preventDefault();
      homePage.style.display = 'none';
      aboutPage.style.display = 'block';
      hamburgerMenu.classList.remove('active');
    });
    
    menuSummaryGraph.addEventListener('click', (e) => {
      e.preventDefault();
      homePage.style.display = 'none';
      summaryGraphPage.style.display = 'block';
      hamburgerMenu.classList.remove('active');
      createPerformanceChart();
    });
    
    // Footer links
    document.getElementById('home-link').addEventListener('click', (e) => {
      e.preventDefault();
      backToSelection();
      userButton.click();
    });
    
    document.getElementById('about-link').addEventListener('click', (e) => {
      e.preventDefault();
      homePage.style.display = 'none';
      aboutPage.style.display = 'block';
    });
    
    document.getElementById('feedback-link').addEventListener('click', (e) => {
      e.preventDefault();
      homePage.style.display = 'none';
      feedbackPage.style.display = 'block';
    });
    
    document.getElementById('recommendations-link').addEventListener('click', (e) => {
      e.preventDefault();
      homePage.style.display = 'none';
      recommendationsPage.style.display = 'block';
    });
    
    // Image upload functionality
    imageUploadContainer.addEventListener('click', () => {
      imageUploadInput.click();
    });
    
    imageUploadInput.addEventListener('change', handleImageUpload);
    
    // Drag and drop functionality
    imageUploadContainer.addEventListener('dragover', (e) => {
      e.preventDefault();
      imageUploadContainer.classList.add('dragover');
    });
    
    imageUploadContainer.addEventListener('dragleave', () => {
      imageUploadContainer.classList.remove('dragover');
    });
    
    imageUploadContainer.addEventListener('drop', (e) => {
      e.preventDefault();
      imageUploadContainer.classList.remove('dragover');
      
      if (e.dataTransfer.files.length) {
        imageUploadInput.files = e.dataTransfer.files;
        handleImageUpload();
      }
    });
    
    // Crop category filtering - FIXED
    categoryButtons.forEach(button => {
      button.addEventListener('click', () => {
        // Remove active class from all buttons
        categoryButtons.forEach(btn => btn.classList.remove('active'));
        // Add active class to clicked button
        button.classList.add('active');
        
        // Refresh displayed crops
        displayFeaturedCrops();
      });
    });
    
    // Update chart button
    updateChartBtn.addEventListener('click', createPerformanceChart);
  }

  // Handle image upload
  function handleImageUpload() {
    const file = imageUploadInput.files[0];
    if (file) {
      const reader = new FileReader();
      
      reader.onload = function(e) {
        imagePreview.src = e.target.result;
        imagePreview.style.display = 'block';
        imageUploadText.style.display = 'none';
      };
      
      reader.readAsDataURL(file);
    }
  }

  // Toggle between dark and light theme
  function toggleTheme() {
    document.body.classList.toggle('dark-mode');
    const themeText = document.getElementById('theme-text');
    const themeIcon = document.querySelector('.theme-toggle i');
    
    if (document.body.classList.contains('dark-mode')) {
      themeText.textContent = translations[currentLang]['theme-text-light'];
      themeIcon.className = 'fas fa-sun';
    } else {
      themeText.textContent = translations[currentLang]['theme-text'];
      themeIcon.className = 'fas fa-moon';
    }
  }

  // Change language
function changeLanguage(lang) {
  currentLang = lang;
  document.getElementById('current-language').textContent =
    lang === 'en' ? 'English' : 'አማርኛ';

  applyTranslations(lang);

  // ✅ Update category button labels
  const categoryButtons = document.querySelectorAll('.category-btn');
  categoryButtons.forEach(btn => {
    if (lang === 'am') {
      btn.textContent = btn.getAttribute('data-category-am');
    } else {
      btn.textContent = btn.getAttribute('data-category-en');
    }
  });

  // Update crop display if a crop is currently being viewed
  if (currentCrop) {
    displayCrop(currentCrop);
  }

  // Update dropdown options
  updateDropdownOptions();

  // Update admin table buttons
  populateCropsTable();
  populateFeedbackTable();

  // Update chart if it exists
  if (performanceChart) {
    createPerformanceChart();
  }

  // Refresh displayed crops to update category filtering
  displayFeaturedCrops();
}

  // Update dropdown options based on language
  function updateDropdownOptions() {
    const altitudeFilter = document.getElementById('altitude-filter');
    const rainfallFilter = document.getElementById('rainfall-filter');
    const soilTypeFilter = document.getElementById('soil-type-filter');
    const seasonFilter = document.getElementById('season-filter');
    const marketFilter = document.getElementById('market-filter');
    
    if (currentLang === 'am') {
      // Update altitude options
      altitudeFilter.options[1].text = 'ዝቅተኛ (0-1500ሜ)';
      altitudeFilter.options[2].text = 'መካከለኛ (1500-2500ሜ)';
      altitudeFilter.options[3].text = 'ከፍተኛ (2500ሜ+)';
      
      // Update rainfall options
      rainfallFilter.options[1].text = 'ዝቅተኛ (<500ሚሜ)';
      rainfallFilter.options[2].text = 'መካከለኛ (500-1000ሚሜ)';
      rainfallFilter.options[3].text = 'ከፍተኛ (>1000ሚሜ)';
      
      // Update soil type options
      soilTypeFilter.options[1].text = 'ጭቃ';
      soilTypeFilter.options[2].text = 'ሸለቆ';
      soilTypeFilter.options[3].text = 'አሸዋ';
      soilTypeFilter.options[4].text = 'እሳስ';
      
      // Update season options
      seasonFilter.options[1].text = 'ጸደይ';
      seasonFilter.options[2].text = 'ክረምት';
      seasonFilter.options[3].text = 'መሐረር';
      seasonFilter.options[4].text = 'በጋ';
      
      // Update market options
      marketFilter.options[1].text = 'አገር አዋሳኝ';
      marketFilter.options[2].text = 'ላኪ';
      marketFilter.options[3].text = 'ማቀነባበሪያ';
    } else {
      // Update altitude options
      altitudeFilter.options[1].text = 'Low (0-1500m)';
      altitudeFilter.options[2].text = 'Medium (1500-2500m)';
      altitudeFilter.options[3].text = 'High (2500m+)';
      
      // Update rainfall options
      rainfallFilter.options[1].text = 'Low (<500mm)';
      rainfallFilter.options[2].text = 'Medium (500-1000mm)';
      rainfallFilter.options[3].text = 'High (>1000mm)';
      
      // Update soil type options
      soilTypeFilter.options[1].text = 'Clay';
      soilTypeFilter.options[2].text = 'Loam';
      soilTypeFilter.options[3].text = 'Sandy';
      soilTypeFilter.options[4].text = 'Volcanic';
      
      // Update season options
      seasonFilter.options[1].text = 'Spring';
      seasonFilter.options[2].text = 'Summer';
      seasonFilter.options[3].text = 'Autumn';
      seasonFilter.options[4].text = 'Winter';
      
      // Update market options
      marketFilter.options[1].text = 'Local Consumption';
      marketFilter.options[2].text = 'Export';
      marketFilter.options[3].text = 'Processing';
    }
  }

  // Perform search
  function performSearch() {
    const query = document.getElementById('search-input').value.toLowerCase();
    const resultsContainer = document.getElementById('search-results');
    
    if (query.length < 2) {
      resultsContainer.style.display = 'none';
      noResultsMessage.style.display = 'none';
      return;
    }
    
    const results = crops.filter(crop => 
      crop.name.en.toLowerCase().includes(query) || 
      crop.name.am.toLowerCase().includes(query) ||
      crop.scientific.toLowerCase().includes(query) ||
      (crop.category.en && crop.category.en.toLowerCase().includes(query)) ||
      (crop.category.am && crop.category.am.toLowerCase().includes(query))
    );
    
    resultsContainer.innerHTML = '';
    
    if (results.length > 0) {
      results.forEach(crop => {
        const resultItem = document.createElement('div');
        resultItem.className = 'search-result-item';
        resultItem.textContent = `${crop.name.en} (${crop.category.en})`;
        resultItem.addEventListener('click', () => {
          // Track view count
          if (!crop.views) crop.views = 0;
          crop.views++;
          updateStats();
          displayCrop(crop);
          resultsContainer.style.display = 'none';
          document.getElementById('search-input').value = '';
        });
        resultsContainer.appendChild(resultItem);
      });
      resultsContainer.style.display = 'block';
      noResultsMessage.style.display = 'none';
    } else {
      resultsContainer.style.display = 'none';
      noResultsMessage.style.display = 'block';
    }
  }

  // Admin login
  function adminLogin() {
            const password = document.getElementById('admin-password-input').value;
            
            if (password === ADMIN_PASSWORD) {
                isAdmin = true;
                adminLoginPanel.style.display = 'none';
                adminPanel.style.display = 'block';
                document.getElementById('admin-password-input').value = '';
                
                // Show admin dashboard
                document.querySelector('.admin-dashboard').style.display = 'grid';
                populateCropsTable();
                populateFeedbackTable();
                updateStats();
            } else {
                alert(currentLang === 'en' ? 'Incorrect password' : 'የተሳሳተ የይለፍ ቃል');
            }
   }

  // Admin logout
  function adminLogout() {
            isAdmin = false;
            adminPanel.style.display = 'none';
            welcomeScreen.style.display = 'block';
        }

  // Back to selection screen
  function backToSelection() {
    homePage.style.display = 'none';
    cropDisplay.style.display = 'none';
    feedbackPage.style.display = 'none';
    recommendationsPage.style.display = 'none';
    aboutPage.style.display = 'none';
    summaryGraphPage.style.display = 'none';
    adminLoginPanel.style.display = 'none';
    adminPanel.style.display = 'none';
    welcomeScreen.style.display = 'block';
  }

  // Open crop modal for adding/editing
  function openCropModal(crop = {}) {
    // Show modal
    const modal = document.getElementById("crop-modal");
    if (modal) modal.style.display = "block";
    document.getElementById("modal-title").textContent = crop._id ? "Edit Crop" : "Add New Crop";

    // Hidden ID
    document.getElementById("crop-id").value = crop._id || "";

    // Main details
    document.getElementById("name-en").value = crop.name?.en || "";
    document.getElementById("name-am").value = crop.name?.am || "";
    document.getElementById("scientific-name").value = crop.scientific || "";
    document.getElementById("category-en").value = crop.category?.en || "";
    document.getElementById("category-am").value = crop.category?.am || "";

    // Varieties (first only)
    if (crop.varieties && crop.varieties.length > 0) {
        const v = crop.varieties[0];
        document.querySelector('[name="variety-en[]"]').value = v.name?.en || "";
        document.querySelector('[name="variety-am[]"]').value = v.name?.am || "";
        document.querySelector('[name="variety-days[]"]').value = v.characteristics?.growing_time_days || "";
        document.querySelector('[name="variety-use-en[]"]').value = v.characteristics?.preferred_use?.en || "";
        document.querySelector('[name="variety-use-am[]"]').value = v.characteristics?.preferred_use?.am || "";
        document.querySelector('[name="variety-disease-en[]"]').value = v.characteristics?.disease_resistance?.en || "";
        document.querySelector('[name="variety-disease-am[]"]').value = v.characteristics?.disease_resistance?.am || "";
        document.querySelector('[name="variety-fertilizer-en[]"]').value = v.characteristics?.fertilizer_requirements?.en || "";
        document.querySelector('[name="variety-fertilizer-am[]"]').value = v.characteristics?.fertilizer_requirements?.am || "";
    }

    // Image
    const imagePreview = document.getElementById("image-preview");
    if (imagePreview) {
        imagePreview.src = crop.image || "https://via.placeholder.com/150";
    }

    // Overview
    document.getElementById("planting-en").value = crop.overview?.plantingTime?.en || "";
    document.getElementById("planting-am").value = crop.overview?.plantingTime?.am || "";
    document.getElementById("growing-en").value = crop.overview?.growingPeriod?.en || "";
    document.getElementById("growing-am").value = crop.overview?.growingPeriod?.am || "";
    document.getElementById("climate-en").value = crop.overview?.climateRequirements?.en || "";
    document.getElementById("climate-am").value = crop.overview?.climateRequirements?.am || "";
    document.getElementById("soil-en").value = crop.overview?.soilType?.en || "";
    document.getElementById("soil-am").value = crop.overview?.soilType?.am || "";

    // Cultivation
    document.getElementById("landprep-en").value = crop.cultivation?.landPrep?.en || "";
    document.getElementById("landprep-am").value = crop.cultivation?.landPrep?.am || "";
    document.getElementById("plantingmethod-en").value = crop.cultivation?.plantingMethod?.en || "";
    document.getElementById("plantingmethod-am").value = crop.cultivation?.plantingMethod?.am || "";
    document.getElementById("spacing-en").value = crop.cultivation?.spacing?.en || "";
    document.getElementById("spacing-am").value = crop.cultivation?.spacing?.am || "";
    document.getElementById("water-en").value = crop.cultivation?.waterRequirements?.en || "";
    document.getElementById("water-am").value = crop.cultivation?.waterRequirements?.am || "";

    // Fertilizers
    const fertContainer = document.getElementById("fertilizers-container");
    fertContainer.innerHTML = "";

    if (crop.fertilizers && crop.fertilizers.length > 0) {
      crop.fertilizers.forEach(fert => {
        const group = document.createElement("div");
        group.className = "fertilizer-group";

        group.innerHTML = `
          <div class="form-group">
            <label>Fertilizer Type (English)</label>
            <input type="text" name="fert-type-en[]" value="${fert.type?.en || ""}">
          </div>
          <div class="form-group">
            <label>Fertilizer Type (Amharic)</label>
            <input type="text" name="fert-type-am[]" value="${fert.type?.am || ""}">
          </div>
          <div class="form-group">
            <label>Application (English)</label>
            <input type="text" name="fert-app-en[]" value="${fert.application?.en || ""}">
          </div>
          <div class="form-group">
            <label>Application (Amharic)</label>
            <input type="text" name="fert-app-am[]" value="${fert.application?.am || ""}">
          </div>
          <div class="form-group">
            <label>Benefits (English)</label>
            <input type="text" name="fert-benefits-en[]" value="${fert.benefits?.en || ""}">
          </div>
          <div class="form-group">
            <label>Benefits (Amharic)</label>
            <input type="text" name="fert-benefits-am[]" value="${fert.benefits?.am || ""}">
          </div>
        `;

        fertContainer.appendChild(group);
      });
    } else {
      // if no fertilizers, create one empty group
      const group = document.createElement("div");
      group.className = "fertilizer-group";
      group.innerHTML = `
        <div class="form-group">
          <label>Fertilizer Type (English)</label>
          <input type="text" name="fert-type-en[]" placeholder="e.g., DAP">
        </div>
        <div class="form-group">
          <label>Fertilizer Type (Amharic)</label>
          <input type="text" name="fert-type-am[]" placeholder="e.g., ዲኤፒ">
        </div>
        <div class="form-group">
          <label>Application (English)</label>
          <input type="text" name="fert-app-en[]" placeholder="e.g., Apply 100-200 kg/ha at planting">
        </div>
        <div class="form-group">
          <label>Application (Amharic)</label>
          <input type="text" name="fert-app-am[]" placeholder="ለምሳሌ፡ 100-200 ኪ.ግ/ሄክታር በመትከል ጊዜ">
        </div>
        <div class="form-group">
          <label>Benefits (English)</label>
          <input type="text" name="fert-benefits-en[]" placeholder="e.g., Provides phosphorus for root development">
        </div>
        <div class="form-group">
          <label>Benefits (Amharic)</label>
          <input type="text" name="fert-benefits-am[]" placeholder="ለምሳሌ፡ ለስር እድገት ፎስፈረስ ያቀርባል">
        </div>
      `;
      fertContainer.appendChild(group);
    }

    // Diseases (first only)
    document.getElementById("disease1-name-en").value = crop.diseases?.[0]?.name?.en || "";
    document.getElementById("disease1-name-am").value = crop.diseases?.[0]?.name?.am || "";
    document.getElementById("disease1-symptom-en").value = crop.diseases?.[0]?.symptoms?.en || "";
    document.getElementById("disease1-symptom-am").value = crop.diseases?.[0]?.symptoms?.am || "";
    document.getElementById("disease1-control-en").value = crop.diseases?.[0]?.control?.en || "";
    document.getElementById("disease1-control-am").value = crop.diseases?.[0]?.control?.am || "";

    // Pests
    document.getElementById("pest1-name-en").value = crop.pests?.[0]?.name?.en || "";
    document.getElementById("pest1-name-am").value = crop.pests?.[0]?.name?.am || "";
    document.getElementById("pest1-symptom-en").value = crop.pests?.[0]?.symptoms?.en || "";
    document.getElementById("pest1-symptom-am").value = crop.pests?.[0]?.symptoms?.am || "";
    document.getElementById("pest1-control-en").value = crop.pests?.[0]?.control?.en || "";
    document.getElementById("pest1-control-am").value = crop.pests?.[0]?.control?.am || "";

    // Harvesting
    document.getElementById("harvest-en").value = crop.harvesting?.harvestTime?.en || "";
    document.getElementById("harvest-am").value = crop.harvesting?.harvestTime?.am || "";
    document.getElementById("harvestmethod-en").value = crop.harvesting?.harvestMethod?.en || "";
    document.getElementById("harvestmethod-am").value = crop.harvesting?.harvestMethod?.am || "";
    document.getElementById("yield-en").value = crop.harvesting?.yieldPotential?.en || "";
    document.getElementById("yield-am").value = crop.harvesting?.yieldPotential?.am || "";
    document.getElementById("postharvest-en").value = crop.harvesting?.postHarvest?.en || "";
    document.getElementById("postharvest-am").value = crop.harvesting?.postHarvest?.am || "";

    // Price
    document.getElementById("price-en-market").value = crop.price?.en?.["Market Price"] || "";
    document.getElementById("price-am-market").value = crop.price?.am?.["Market Price"] || "";
    document.getElementById("price-en-trend").value = crop.price?.en?.["Price Trend"] || "";
    document.getElementById("price-am-trend").value = crop.price?.am?.["Price Trend"] || "";
    document.getElementById("price-en-demand").value = crop.price?.en?.["Market Demand"] || "";
    document.getElementById("price-am-demand").value = crop.price?.am?.["Market Demand"] || "";
    document.getElementById("price-en-export").value = crop.price?.en?.["Export Potential"] || "";
    document.getElementById("price-am-export").value = crop.price?.am?.["Export Potential"] || "";

    // Recommendation
    document.getElementById("recommendation-en").value = crop.recommendation?.en || "";
    document.getElementById("recommendation-am").value = crop.recommendation?.am || "";
  }

  // Close crop modal
  function closeCropModal() {
    const modal = document.getElementById("crop-modal");
    if (modal) modal.style.display = "none";
    cropForm.reset();
  }

  // Save crop (create or update)
  async function saveCrop(e) {
    if (e && e.preventDefault) e.preventDefault();

    const id = document.getElementById("crop-id").value || null;
    const nameEn = document.getElementById("name-en").value.trim();
    const nameAm = document.getElementById("name-am").value.trim();

    // Check for duplicate crop name (case-insensitive)
    const existingCrop = crops.find(crop => 
      crop._id !== id && 
      (crop.name.en.toLowerCase() === nameEn.toLowerCase() || 
       crop.name.am === nameAm)
    );

    if (existingCrop) {
      alert(currentLang === 'en' 
        ? `A crop with the name "${nameEn}" already exists. Please use a different name.` 
        : `"${nameAm}" የሚለው ስም ያለው ሰብል አስቀድሞ አለ። እባክዎ የተለየ ስም ይጠቀሙ።`);
      return;
    }

    // --- Varieties (multiple) ---
    const varieties = [];
    const varietyGroups = document.querySelectorAll("#varieties-container .variety-group");

    varietyGroups.forEach(group => {
      const nameEn = group.querySelector('[name="variety-en[]"]').value.trim();
      const nameAm = group.querySelector('[name="variety-am[]"]').value.trim();

      if (!nameEn && !nameAm) return; // skip empty

      varieties.push({
        name: { en: nameEn, am: nameAm },
        characteristics: {
          growing_time_days: group.querySelector('[name="variety-days[]"]').value
            ? parseInt(group.querySelector('[name="variety-days[]"]').value, 10)
            : null,
          preferred_use: {
            en: group.querySelector('[name="variety-use-en[]"]').value,
            am: group.querySelector('[name="variety-use-am[]"]').value
          },
          disease_resistance: {
            en: group.querySelector('[name="variety-disease-en[]"]').value,
            am: group.querySelector('[name="variety-disease-am[]"]').value
          },
          fertilizer_requirements: {
            en: group.querySelector('[name="variety-fertilizer-en[]"]').value,
            am: group.querySelector('[name="variety-fertilizer-am[]"]').value
          }
        }
      });
    });

    // --- Fertilizers (multiple) ---
    const fertilizers = [];
    const fertGroups = document.querySelectorAll("#fertilizers-container .fertilizer-group");

    fertGroups.forEach(group => {
      const typeEn = group.querySelector('[name="fert-type-en[]"]').value.trim();
      const typeAm = group.querySelector('[name="fert-type-am[]"]').value.trim();

      if (typeEn || typeAm) {
        fertilizers.push({
          type: { en: typeEn, am: typeAm },
          application: {
            en: group.querySelector('[name="fert-app-en[]"]').value || "",
            am: group.querySelector('[name="fert-app-am[]"]').value || ""
          },
          benefits: {
            en: group.querySelector('[name="fert-benefits-en[]"]').value || "",
            am: group.querySelector('[name="fert-benefits-am[]"]').value || ""
          }
        });
      }
    });

    // --- Diseases (only one) ---
    let diseases = [];
    const diseaseNameEn = document.getElementById("disease1-name-en").value.trim();
    const diseaseNameAm = document.getElementById("disease1-name-am").value.trim();
    if (diseaseNameEn || diseaseNameAm) {
      diseases = [
        {
          name: { en: diseaseNameEn, am: diseaseNameAm },
          symptoms: {
            en: document.getElementById("disease1-symptom-en").value || "",
            am: document.getElementById("disease1-symptom-am").value || ""
          },
          control: {
            en: document.getElementById("disease1-control-en").value || "",
            am: document.getElementById("disease1-control-am").value || ""
          }
        }
      ];
    }

    // --- Pests (only one) ---
    let pests = [];
    const pestNameEn = document.getElementById("pest1-name-en").value.trim();
    const pestNameAm = document.getElementById("pest1-name-am").value.trim();
    if (pestNameEn || pestNameAm) {
      pests = [
        {
          name: { en: pestNameEn, am: pestNameAm },
          symptoms: {
            en: document.getElementById("pest1-symptom-en").value || "",
            am: document.getElementById("pest1-symptom-am").value || ""
          },
          control: {
            en: document.getElementById("pest1-control-en").value || "",
            am: document.getElementById("pest1-control-am").value || ""
          }
        }
      ];
    }

    // --- Payload ---
    const payload = {
      name: {
        en: nameEn,
        am: nameAm
      },
      scientific: document.getElementById("scientific-name").value || "",
      category: {
        en: document.getElementById("category-en").value || "",
        am: document.getElementById("category-am").value || ""
      },
      image: document.getElementById("image-preview")?.src || cropImages[nameEn] || "default-crop.png",
      varieties,
      overview: {
        plantingTime: {
          en: document.getElementById("planting-en").value || "",
          am: document.getElementById("planting-am").value || ""
        },
        growingPeriod: {
          en: document.getElementById("growing-en").value || "",
          am: document.getElementById("growing-am").value || ""
        },
        climateRequirements: {
          en: document.getElementById("climate-en").value || "",
          am: document.getElementById("climate-am").value || ""
        },
        soilType: {
          en: document.getElementById("soil-en").value || "",
          am: document.getElementById("soil-am").value || ""
        }
      },
      cultivation: {
        landPrep: {
          en: document.getElementById("landprep-en").value || "",
          am: document.getElementById("landprep-am").value || ""
        },
        plantingMethod: {
          en: document.getElementById("plantingmethod-en").value || "",
          am: document.getElementById("plantingmethod-am").value || ""
        },
        spacing: {
          en: document.getElementById("spacing-en").value || "",
          am: document.getElementById("spacing-am").value || ""
        },
        waterRequirements: {
          en: document.getElementById("water-en").value || "",
          am: document.getElementById("water-am").value || ""
        }
      },
      fertilizers,
      diseases,
      pests,
      harvesting: {
        harvestTime: {
          en: document.getElementById("harvest-en").value || "",
          am: document.getElementById("harvest-am").value || ""
        },
        harvestMethod: {
          en: document.getElementById("harvestmethod-en").value || "",
          am: document.getElementById("harvestmethod-am").value || ""
        },
        yieldPotential: {
          en: document.getElementById("yield-en").value || "",
          am: document.getElementById("yield-am").value || ""
        },
        postHarvest: {
          en: document.getElementById("postharvest-en").value || "",
          am: document.getElementById("postharvest-am").value || ""
        }
      },
      price: {
        en: {
          "Market Price": document.getElementById("price-en-market").value || "",
          "Price Trend": document.getElementById("price-en-trend").value || "",
          "Market Demand": document.getElementById("price-en-demand").value || "",
          "Export Potential": document.getElementById("price-en-export").value || ""
        },
        am: {
          "Market Price": document.getElementById("price-am-market").value || "",
          "Price Trend": document.getElementById("price-am-trend").value || "",
          "Market Demand": document.getElementById("price-am-demand").value || "",
          "Export Potential": document.getElementById("price-am-export").value || ""
        }
      },
      recommendation: {
        en: document.getElementById("recommendation-en").value || "",
        am: document.getElementById("recommendation-am").value || ""
      }
    };

    console.log("Payload being sent:", payload);

    try {
      const urlBase = DB_CONFIG.apiBase || "/api";
      let url = `${urlBase}/crops`;
      let method = "POST";
      if (id) {
        url = `${urlBase}/crops/${id}`;
        method = "PUT";
      }

      const res = await fetch(url, {
        method,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      if (!res.ok) {
        const text = await res.text();
        throw new Error(`Server ${res.status}: ${text}`);
      }

      await res.json();
      await loadCrops();
      closeCropModal();
      
      // Add to recent activities
      addRecentActivity(currentLang === 'en' ? 
        (id ? 'Crop updated' : 'New crop added') : 
        (id ? 'ሰብል ተስተካክሏል' : 'አዲስ ሰብል ታክሏል'));
        
      alert("✅ Crop saved successfully!");
    } catch (err) {
      console.error("Error saving crop:", err);
      alert(`❌ Failed to save crop: ${err.message}`);
    }
  }

  // Populate crops table in admin panel
  function populateCropsTable() {
    const cropsTableBody = document.getElementById("crops-table-body");
    if (!cropsTableBody) return;

    cropsTableBody.innerHTML = "";

    if (!Array.isArray(crops)) {
      console.error("Crops data is not an array:", crops);
      return;
    }

    crops.forEach(crop => {
      const cropName = crop.name?.en || "Unnamed Crop";
      const scientificName = crop.scientific || "N/A";
      const dateAdded = crop.date_added
        ? new Date(crop.date_added).toLocaleDateString()
        : new Date().toLocaleDateString();

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${cropName}</td>
        <td>${scientificName}</td>
        <td>${dateAdded}</td>
        <td class="action-cell">
          <button class="admin-button edit-crop" data-id="${crop._id || crop.id || ""}">
            <i class="fas fa-edit"></i> ${currentLang === "en" ? "Edit" : "አስተካክል"}
          </button>
          <button class="admin-button delete-button delete-crop" data-id="${crop._id || crop.id || ""}">
            <i class="fas fa-trash"></i> ${currentLang === "en" ? "Delete" : "ሰርዝ"}
          </button>
        </td>
      `;
      cropsTableBody.appendChild(row);
    });

    // Event delegation for performance
    cropsTableBody.addEventListener("click", (e) => {
      if (e.target.closest(".edit-crop")) {
        const cropId = e.target.closest(".edit-crop").dataset.id;
        const crop = crops.find(c => c._id === cropId || c.id === cropId);
        if (crop) openCropModal(crop);
      }
      if (e.target.closest(".delete-crop")) {
        const cropId = e.target.closest(".delete-crop").dataset.id;
        deleteCrop(cropId);
      }
    });
  }

  // Delete crop function
  async function deleteCrop(cropId) {
    if (!confirm(currentLang === 'en' ? 'Are you sure you want to delete this crop?' : 'እርግጠኛ ነዎት ይህን ሰብል መሰረዝ ይፈልጋሉ?')) return;

    try {
      const res = await fetch(`${DB_CONFIG.apiBase}/crops/${cropId}`, { method: 'DELETE' });
      if (!res.ok) {
        const text = await res.text();
        throw new Error(`Server error: ${res.status} ${text}`);
      }

      // refresh from server
      await loadCrops();

      addRecentActivity(currentLang === 'en' ? 'Crop deleted' : 'ሰብል ተሰርዟል');
      alert(currentLang === 'en' ? 'Crop deleted successfully!' : 'ሰብሉ ተሰርዟል!');
    } catch (err) {
      console.error('Error deleting crop:', err);
      alert(currentLang === 'en' ? `Failed to delete: ${err.message}` : 'ሰብል ለመሰረዝ አልተቻለም።');
    }
  }

  // Populate feedback table in admin panel
  function populateFeedbackTable() {
    feedbackTableBody.innerHTML = '';
    
    userFeedback.forEach((feedback, index) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${feedback.name}</td>
        <td>${new Date(feedback.date).toLocaleDateString()}</td>
        <td>${feedback.message.length > 50 ? feedback.message.substring(0, 50) + '...' : feedback.message}</td>
        <td class="action-cell">
          <button class="admin-button view-feedback" data-index="${index}"><i class="fas fa-eye"></i> ${currentLang === 'en' ? 'View' : 'ተመልከት'}</button>
          <button class="admin-button delete-button delete-feedback" data-index="${index}"><i class="fas fa-trash"></i> ${currentLang === 'en' ? 'Delete' : 'ሰርዝ'}</button>
        </td>
      `;
      
      feedbackTableBody.appendChild(row);
    });
    
    // Add event listeners to view and delete buttons
    document.querySelectorAll('.view-feedback').forEach(button => {
      button.addEventListener('click', (e) => {
        const index = e.target.closest('.view-feedback').getAttribute('data-index');
        const feedback = userFeedback[index];
        alert(`${feedback.name}: ${feedback.message}`);
      });
    });
    
    document.querySelectorAll('.delete-feedback').forEach(button => {
      button.addEventListener('click', (e) => {
        const index = e.target.closest('.delete-feedback').getAttribute('data-index');
        if (confirm(currentLang === 'en' ? 'Are you sure you want to delete this feedback?' : 'እርግጠኛ ነዎት ይህን ግብረ መልስ መሰረዝ ይፈልጋሉ?')) {
          userFeedback.splice(index, 1);
          localStorage.setItem('userFeedback', JSON.stringify(userFeedback));
          populateFeedbackTable();
          
          // Add to recent activities
          addRecentActivity(currentLang === 'en' ? 'Feedback deleted' : 'ግብረ መልስ ተሰርዟል');
        }
      });
    });
  }

  // Toggle chatbot visibility
  function toggleChatbot() {
    chatbotWindow.style.display = chatbotWindow.style.display === 'flex' ? 'none' : 'flex';
  }

  // Send chat message - FIXED to use actual crop data
  function sendChatMessage() {
    const message = chatbotInput.value.trim();
    if (message === '') return;
    
    // Add user message
    const userMessage = document.createElement('div');
    userMessage.className = 'message user-message';
    userMessage.textContent = message;
    chatbotMessages.appendChild(userMessage);
    
    // Clear input
    chatbotInput.value = '';
    
    // Scroll to bottom
    chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
    
    // Generate bot response (using actual crop data)
    setTimeout(() => {
      const botResponse = generateBotResponse(message);
      const botMessage = document.createElement('div');
      botMessage.className = 'message bot-message';
      botMessage.textContent = botResponse;
      chatbotMessages.appendChild(botMessage);
      
      // Scroll to bottom
      chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
    }, 1000);
  }

  // Generate bot response based on user message - FIXED to use actual crop data
  function generateBotResponse(message) {
    const lowerMessage = message.toLowerCase();
    
    // Check for crop-related queries
    for (const crop of crops) {
      const cropNameEn = crop.name?.en?.toLowerCase() || '';
      const cropNameAm = crop.name?.am || '';
      
      if (lowerMessage.includes(cropNameEn) || lowerMessage.includes(cropNameAm)) {
        let response = `${currentLang === 'en' ? 'Information about' : 'ስለ'} ${crop.name[currentLang]}:\n`;
        
        // Check what specific information is being asked about
        if (lowerMessage.includes('overview') || lowerMessage.includes('general') || lowerMessage.includes('ግኝት') || lowerMessage.includes('አጠቃላይ')) {
          response += `${currentLang === 'en' ? 'Planting Time' : 'የመትከል ጊዜ'}: ${crop.overview?.plantingTime?.[currentLang] || 'N/A'}\n`;
          response += `${currentLang === 'en' ? 'Growing Period' : 'የእድገት ጊዜ'}: ${crop.overview?.growingPeriod?.[currentLang] || 'N/A'}\n`;
          response += `${currentLang === 'en' ? 'Climate Requirements' : 'የአየር ንብረት መስፈርቶች'}: ${crop.overview?.climateRequirements?.[currentLang] || 'N/A'}\n`;
        } 
        else if (lowerMessage.includes('cultivation') || lowerMessage.includes('growing') || lowerMessage.includes('ልማት') || lowerMessage.includes('መትከል')) {
          response += `${currentLang === 'en' ? 'Land Preparation' : 'ምድር አዘገጃጀት'}: ${crop.cultivation?.landPrep?.[currentLang] || 'N/A'}\n`;
          response += `${currentLang === 'en' ? 'Planting Method' : 'የመትከያ ዘዴ'}: ${crop.cultivation?.plantingMethod?.[currentLang] || 'N/A'}\n`;
          response += `${currentLang === 'en' ? 'Spacing' : 'መካከለኛ ርቀት'}: ${crop.cultivation?.spacing?.[currentLang] || 'N/A'}\n`;
          response += `${currentLang === 'en' ? 'Water Requirements' : 'የውሃ ፍላጎት'}: ${crop.cultivation?.waterRequirements?.[currentLang] || 'N/A'}`;
        }
        else if (lowerMessage.includes('fertilizer') || lowerMessage.includes('nutrient') || lowerMessage.includes('ማዳበሪያ') || lowerMessage.includes('ምግብ')) {
          response += `${currentLang === 'en' ? 'Fertilizer Recommendations' : 'የማዳበሪያ ምክሮች'}:\n`;
          if (crop.fertilizers && crop.fertilizers.length > 0) {
            crop.fertilizers.forEach(fert => {
              response += `${fert.type?.[currentLang] || fert.type?.en || 'N/A'}: ${fert.application?.[currentLang] || fert.application?.en || 'N/A'}\n`;
            });
          } else {
            response += currentLang === 'en' ? 'No fertilizer information available.' : 'የማዳበሪያ መረጃ አልተገኘም።';
          }
        }
        else if (lowerMessage.includes('disease') || lowerMessage.includes('pest') || lowerMessage.includes('በሽታ') || lowerMessage.includes('አረም')) {
          response += `${currentLang === 'en' ? 'Disease and Pest Control' : 'የበሽታ እና የአረም መቆጣጠሪያ'}:\n`;
          if (crop.diseases && crop.diseases.length > 0) {
            crop.diseases.forEach(disease => {
              response += `${disease.name?.[currentLang] || disease.name?.en || 'N/A'}: ${disease.control?.[currentLang] || disease.control?.en || 'N/A'}\n`;
            });
          }
          if (crop.pests && crop.pests.length > 0) {
            crop.pests.forEach(pest => {
              response += `${pest.name?.[currentLang] || pest.name?.en || 'N/A'}: ${pest.control?.[currentLang] || pest.control?.en || 'N/A'}\n`;
            });
          }
          if (!crop.diseases && !crop.pests) {
            response += currentLang === 'en' ? 'No disease or pest information available.' : 'የበሽታ ወይም የአረም መረጃ አልተገኘም።';
          }
        }
        else if (lowerMessage.includes('harvest') || lowerMessage.includes('yield') || lowerMessage.includes('ማጨድ') || lowerMessage.includes('ምርት')) {
          response += `${currentLang === 'en' ? 'Harvest Information' : 'የማጨድ መረጃ'}:\n`;
          response += `${currentLang === 'en' ? 'Harvest Time' : 'የማጨድ ጊዜ'}: ${crop.harvesting?.harvestTime?.[currentLang] || 'N/A'}\n`;
          response += `${currentLang === 'en' ? 'Harvest Method' : 'የማጨድ ዘዴ'}: ${crop.harvesting?.harvestMethod?.[currentLang] || 'N/A'}\n`;
          response += `${currentLang === 'en' ? 'Expected Yield' : 'የሚጠበቀ ምርት'}: ${crop.harvesting?.yieldPotential?.[currentLang] || 'N/A'}`;
        }
        else if (lowerMessage.includes('price') || lowerMessage.includes('market') || lowerMessage.includes('ዋጋ') || lowerMessage.includes('ገበያ')) {
          response += `${currentLang === 'en' ? 'Market Information' : 'የገበያ መረጃ'}:\n`;
          response += `${currentLang === 'en' ? 'Market Price' : 'የገበያ ዋጋ'}: ${crop.price?.[currentLang]?.["Market Price"] || 'N/A'}\n`;
          response += `${currentLang === 'en' ? 'Market Demand' : 'የገበያ ፍላጎት'}: ${crop.price?.[currentLang]?.["Market Demand"] || 'N/A'}\n`;
          response += `${currentLang === 'en' ? 'Export Potential' : 'የማስለቀቅ አቅም'}: ${crop.price?.[currentLang]?.["Export Potential"] || 'N/A'}`;
        }
        else if (lowerMessage.includes('recommendation') || lowerMessage.includes('advice') || lowerMessage.includes('ምክር') || lowerMessage.includes('አማካሪ')) {
          response += `${currentLang === 'en' ? 'Expert Recommendations' : 'የባለሙያ ምክሮች'}:\n`;
          response += `${crop.recommendation?.[currentLang] || crop.recommendation?.en || 'N/A'}`;
        }
        else if (lowerMessage.includes('varieties') || lowerMessage.includes('features') || lowerMessage.includes('ባህሪ') || lowerMessage.includes('ገጽታ')) {
          response += `${currentLang === 'en' ? 'Crop varieties' : 'የሰብል ባህሪያት'}:\n`;
          if (crop.varieties && crop.varieties.length > 0) {
            crop.varieties.forEach(variety => {
              response += `${variety.name?.[currentLang] || variety.name?.en || 'N/A'}: ${variety.characteristics?.growing_time_days || 'N/A'} ${currentLang === 'en' ? 'days' : 'ቀናት'}\n`;
            });
          } else {
            response += currentLang === 'en' ? 'No variety information available.' : 'የዝርያ መረጃ አልተገኘም።';
          }
        }
        else {
          // General information about the crop
          response += `${currentLang === 'en' ? 'Planting Time' : 'የመትከል ጊዜ'}: ${crop.overview?.plantingTime?.[currentLang] || 'N/A'}\n`;
          response += `${currentLang === 'en' ? 'Growing Period' : 'የእድገት ጊዜ'}: ${crop.overview?.growingPeriod?.[currentLang] || 'N/A'}\n`;
          response += `${currentLang === 'en' ? 'Climate Requirements' : 'የአየር ንብረት መስፈርቶች'}: ${crop.overview?.climateRequirements?.[currentLang] || 'N/A'}\n`;
        }
        
        return response;
      }
    }
    
    // Check for general queries
    if (lowerMessage.includes('weather') || lowerMessage.includes('climate') || lowerMessage.includes('አየር') || lowerMessage.includes('አየር ንብረት')) {
      return currentLang === 'en' 
        ? 'Ethiopia has diverse climatic conditions. Most crops grow well in temperatures between 10-30°C with adequate rainfall.' 
        : 'ኢትዮጵያ የተለያዩ የአየር ንብረት ሁኔታዎች አሉት። አብዛኛዎቹ ሰብሎች በ10-30°C የሙቀት መጠን እና በበቂ የዝናብ መጠን በሚገኝበት ጊዜ በደንብ ያድጋሉ።';
    } else if (lowerMessage.includes('soil') || lowerMessage.includes('earth') || lowerMessage.includes('አፈር') || lowerMessage.includes('ምድር')) {
      return currentLang === 'en' 
        ? 'Different crops require different soil types. Most crops grow well in well-drained loamy soils with good organic matter content.' 
        : 'የተለያዩ ሰብሎች የተለያዩ የአፈር አይነቶች ያስፈልጋቸዋል። አብዛኛዎቹ ሰብሎች በደንብ የሚፈሳ ከጭቃ አፈር እና በጥሩ የኦርጋኒክ ንጥረ ነገር ይዘት በሚገኝበት ጊዜ በደንብ ያድጋሉ።';
    } else if (lowerMessage.includes('fertilizer') || lowerMessage.includes('nutrient') || lowerMessage.includes('ማዳበሪያ') || lowerMessage.includes('ምግብ')) {
      return currentLang === 'en' 
        ? 'Common fertilizers used in Ethiopia include DAP, Urea, and compost. The application rates depend on the specific crop and soil conditions.' 
        : 'በኢትዮጵያ የሚጠቀሙ የተለመዱ ማዳበሪያዎች ዲ.ኤ.ፒ፣ ዩሪያ እና ኮምፖስት ያካትታሉ። የአተገባበር መጠን በተወሰነ ሰብል እና በአፈር ሁኔታ ላይ የተመሰረተ ነው።';
    } else if (lowerMessage.includes('help') || lowerMessage.includes('support') || lowerMessage.includes('እርዳ') || lowerMessage.includes('ድጋፍ')) {
      return currentLang === 'en' 
        ? 'I can help you with information about crops, weather conditions, soil requirements, and fertilizer recommendations. Just ask me a question!' 
        : 'ስለ ሰብሎች፣ የአየር ሁኔታዎች፣ የአፈር መስፈርቶች እና የማዳበሪያ ምክሮች መረጃ ልርዳችኋል። ጥያቄ ብቻ ይጠይቁኝ!';
    } else if (lowerMessage.includes('price') || lowerMessage.includes('cost') || lowerMessage.includes('ዋጋ') || lowerMessage.includes('ኪራይ')) {
      return currentLang === 'en' 
        ? 'Crop prices vary by season and region. Check the pricing tab on individual crop pages for detailed price information.' 
        : 'የሰብል ዋጋዎች በወቅት እና በክልል ይለያያሉ። ዝርዝር የዋጋ መረጃ ለማየት በግለሰብ የሰብል ገጾች ላይ ያለውን የዋጋ ትር ይመልከቱ።';
    } else if (lowerMessage.includes('disease') || lowerMessage.includes('sickness') || lowerMessage.includes('በሽታ') || lowerMessage.includes('እጥረት')) {
      return currentLang === 'en' 
        ? 'Common crop diseases in Ethiopia include rust, smut, and fungal infections. Check the diseases tab on crop pages for prevention and treatment methods.' 
        : 'በኢትዮጵያ ውስጥ የተለመዱ የሰብል በሽታዎች ቢላታ፣ ኮም፣ እና ፈንገስ ናቸው። ለመከላከል እና ለመድን ዘዴዎች በሰብል ገጾች ላይ ያለውን የበሽታ ትር ይመልከቱ።';
    } else if (lowerMessage.includes('pest') || lowerMessage.includes('insect') || lowerMessage.includes('አረም') || lowerMessage.includes('ትል')) {
      return currentLang === 'en' 
        ? 'Common pests include aphids, stalk borers, and weevils. Integrated pest management combining cultural, biological and chemical methods is recommended.' 
        : 'ተለመዱ ንቦች ፋፍላዎች፣ የእግዜር ቀዳዳ አውጪዎች እና ዊቪሎችን ያካትታሉ። የባህላዊ፣ ባዮሎጂካል እና ኬሚካላዊ ዘዴዎችን የሚያጣምር የተዋሃደ የንቦች አስተዳደር ይመከራል።';
    } else if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('ሰላም') || lowerMessage.includes('ጤና')) {
      return currentLang === 'en' 
        ? "Hello! How can I help you with crop information today?" 
        : "ሰላም! ዛሬ በሰብል መረጃ እንዴት ልርዳችሁ?";
    } else {
      return currentLang === 'en' 
        ? "I'm here to help with information about crops in Ethiopia. You can ask me about specific crops, cultivation practices, or fertilizer recommendations." 
        : "ስለ ኢትዮጵያ ውስጥ ያሉ ሰብሎች መረጃ ለመርዳት እዚህ ነኝ። ስለ የተወሰኑ ሰብሎች፣ የልማት ልምዶች ወይም የማዳበሪያ ምክሮች መጠየቅ ትችላላችሁ።";
    }
  }

  // Submit feedback form
  function submitFeedbackForm() {
    const name = document.getElementById('feedback-name').value;
    const message = document.getElementById('feedback-message').value;
    
    if (!name || !message) {
      alert(currentLang === 'en' ? 'Please fill in all required fields' : 'እባክዎ ሁሉንም የሚያስፈልጉ መስኮች ይሙሉ');
      return;
    }
    
    // Save feedback
    const feedback = {
      name,
      message,
      date: new Date().toISOString()
    };
    
    userFeedback.push(feedback);
    localStorage.setItem('userFeedback', JSON.stringify(userFeedback));
    
    // Clear form
    document.getElementById('feedback-name').value = '';
    document.getElementById('feedback-message').value = '';
    
    alert(currentLang === 'en' ? 'Thank you for your feedback!' : 'ግብረ መልስዎ ስላሳደረጉ እናመሰግናለን!');
    
    // Add to recent activities if admin is logged in
    if (isAdmin) {
      addRecentActivity(currentLang === 'en' ? 'New feedback received' : 'አዲስ ግብረ መልስ ተብሏል');
      populateFeedbackTable();
    }
  }

  // Add fertilizer field functionality
  document.getElementById("add-fertilizer-btn").addEventListener("click", () => {
    const container = document.getElementById("fertilizers-container");

    // clone the first fertilizer-group
    const firstGroup = container.querySelector(".fertilizer-group");
    const newGroup = firstGroup.cloneNode(true);

    // clear input values
    newGroup.querySelectorAll("input").forEach(input => {
      input.value = "";
    });

    container.appendChild(newGroup);
  });

  // Apply recommendation filters
  function applyRecommendationFilters() {
    const altitude = document.getElementById('altitude-filter').value;
    const rainfall = document.getElementById('rainfall-filter').value;
    const soilType = document.getElementById('soil-type-filter').value;
    const season = document.getElementById('season-filter').value;
    const market = document.getElementById('market-filter').value;
    
    // Filter crops based on selected criteria using ML-like algorithm
    const filteredCrops = crops.filter(crop => {
      let score = 0;
      
      // Simple scoring system (in a real app, this would be more sophisticated)
      if (altitude) {
        if (altitude === 'low' && crop.overview?.climateRequirements?.en?.toLowerCase().includes('low')) score += 20;
        if (altitude === 'medium' && crop.overview?.climateRequirements?.en?.toLowerCase().includes('medium')) score += 20;
        if (altitude === 'high' && crop.overview?.climateRequirements?.en?.toLowerCase().includes('high')) score += 20;
      }
      if (rainfall) {
        if (rainfall === 'low' && crop.overview?.climateRequirements?.en?.toLowerCase().includes('low')) score += 20;
        if (rainfall === 'medium' && crop.overview?.climateRequirements?.en?.toLowerCase().includes('medium')) score += 20;
        if (rainfall === 'high' && crop.overview?.climateRequirements?.en?.toLowerCase().includes('high')) score += 20;
      }
      if (soilType && crop.overview?.soilType?.en?.toLowerCase().includes(soilType)) score += 20;
      if (season && crop.overview?.plantingTime?.en?.toLowerCase().includes(season)) score += 20;
      
      return score > 0;
    });
    
    // Sort by score (descending)
    filteredCrops.sort((a, b) => {
      const scoreA = calculatePerformanceScore(a, 'yield') + calculatePerformanceScore(a, 'market');
      const scoreB = calculatePerformanceScore(b, 'yield') + calculatePerformanceScore(b, 'market');
      return scoreB - scoreA;
    });
    
    // Display filtered results
    displayRecommendationResults(filteredCrops);
  }

  // Display recommendation results
  function displayRecommendationResults(crops) {
    recommendationResults.innerHTML = '';
    
    if (crops.length === 0) {
      recommendationResults.innerHTML = `<p>${currentLang === 'en' ? 'No crops match your criteria. Try adjusting your filters.' : 'ምንም ሰብሎች ከመስፈርትዎ ጋር አይጣጣሙም። ማጣሪያዎችዎን ይለውጡ እና ይፈትኑ።'}</p>`;
      return;
    }
    
    crops.forEach(crop => {
      const card = document.createElement('div');
      card.className = 'recommendation-card';
      card.innerHTML = `
        <h3>${crop.name.en}</h3>
        <p><strong>${currentLang === 'en' ? 'Scientific Name' : 'ሳይንሳዊ ስም'}:</strong> ${crop.scientific}</p>
        <p><strong>${currentLang === 'en' ? 'Best For' : 'ለምርጥ የሚመከር'}:</strong> ${crop.overview?.climateRequirements?.en || 'N/A'}, ${crop.overview?.soilType?.en || 'N/A'}</p>
        <p><strong>${currentLang === 'en' ? 'Yield Potential' : 'የምርት አቅም'}:</strong> ${crop.harvesting?.yieldPotential?.en || 'N/A'}</p>
        <button class="admin-button view-crop-btn" data-id="${crop._id}">${currentLang === 'en' ? 'View Details' : 'ዝርዝሮችን ይመልከቱ'}</button>
      `;
      
      recommendationResults.appendChild(card);
    });
    
    // Add event listeners to view buttons
    document.querySelectorAll('.view-crop-btn').forEach(button => {
      button.addEventListener('click', (e) => {
        const cropId = e.target.getAttribute('data-id');
        const crop = crops.find(c => c._id === cropId);
        // Track view count
        if (!crop.views) crop.views = 0;
        crop.views++;
        updateStats();
        displayCrop(crop);
        recommendationsPage.style.display = 'none';
      });
    });
  }

  // Download as Excel
  function downloadAsExcel() {
    // Prepare data for Excel with both languages
    const data = crops.map(crop => ({
      'Crop Name (EN)': crop.name.en,
      'Crop Name (AM)': crop.name.am,
      'Scientific Name': crop.scientific,
      'Category': crop.category.en,
      'Planting Time (EN)': crop.overview?.plantingTime?.en || 'N/A',
      'Planting Time (AM)': crop.overview?.plantingTime?.am || 'N/A',
      'Growing Period (EN)': crop.overview?.growingPeriod?.en || 'N/A',
      'Growing Period (AM)': crop.overview?.growingPeriod?.am || 'N/A',
      'Climate (EN)': crop.overview?.climateRequirements?.en || 'N/A',
      'Climate (AM)': crop.overview?.climateRequirements?.am || 'N/A',
      'Soil Type (EN)': crop.overview?.soilType?.en || 'N/A',
      'Soil Type (AM)': crop.overview?.soilType?.am || 'N/A',
      'Water Requirements (EN)': crop.cultivation?.waterRequirements?.en || 'N/A',
      'Water Requirements (AM)': crop.cultivation?.waterRequirements?.am || 'N/A',
      'Yield (EN)': crop.harvesting?.yieldPotential?.en || 'N/A',
      'Yield (AM)': crop.harvesting?.yieldPotential?.am || 'N/A',
      'Market Price (EN)': crop.price?.en?.["Market Price"] || 'N/A',
      'Market Price (AM)': crop.price?.am?.["Market Price"] || 'N/A'
    }));
    
    // Create worksheet
    const worksheet = XLSX.utils.json_to_sheet(data);
    
    // Create workbook
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, 'Crop Information');
    
    // Generate Excel file
    XLSX.writeFile(workbook, 'crop-information.xlsx');
    
    // Update download count
    appStats.totalDownloads++;
    localStorage.setItem('appStats', JSON.stringify(appStats));
    updateStats();
    
    // Add to recent activities if admin is logged in
    if (isAdmin) {
      addRecentActivity(currentLang === 'en' ? 'Excel downloaded' : 'Excel ተወርዷል');
    }
  }

  // Download individual crop as Excel
  function downloadCropAsExcel() {
    if (!currentCrop) return;
    
    // Prepare data for Excel with both languages
    const data = [{
      'Crop Name (EN)': currentCrop.name.en,
      'Crop Name (AM)': currentCrop.name.am,
      'Scientific Name': currentCrop.scientific,
      'Category': currentCrop.category.en,
      'Planting Time (EN)': currentCrop.overview?.plantingTime?.en || 'N/A',
      'Planting Time (AM)': currentCrop.overview?.plantingTime?.am || 'N/A',
      'Growing Period (EN)': currentCrop.overview?.growingPeriod?.en || 'N/A',
      'Growing Period (AM)': currentCrop.overview?.growingPeriod?.am || 'N/A',
      'Climate (EN)': currentCrop.overview?.climateRequirements?.en || 'N/A',
      'Climate (AM)': currentCrop.overview?.climateRequirements?.am || 'N/A',
      'Soil Type (EN)': currentCrop.overview?.soilType?.en || 'N/A',
      'Soil Type (AM)': currentCrop.overview?.soilType?.am || 'N/A',
      'Water Requirements (EN)': currentCrop.cultivation?.waterRequirements?.en || 'N/A',
      'Water Requirements (AM)': currentCrop.cultivation?.waterRequirements?.am || 'N/A',
      'Yield (EN)': currentCrop.harvesting?.yieldPotential?.en || 'N/A',
      'Yield (AM)': currentCrop.harvesting?.yieldPotential?.am || 'N/A',
      'Market Price (EN)': currentCrop.price?.en?.["Market Price"] || 'N/A',
      'Market Price (AM)': currentCrop.price?.am?.["Market Price"] || 'N/A'
    }];
    
    // Create worksheet
    const worksheet = XLSX.utils.json_to_sheet(data);
    
    // Create workbook
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, `${currentCrop.name.en} Information`);
    
    // Generate Excel file
    XLSX.writeFile(workbook, `${currentCrop.name.en}-information.xlsx`);
    
    // Update download count
    appStats.totalDownloads++;
    localStorage.setItem('appStats', JSON.stringify(appStats));
    updateStats();
    
    // Add to recent activities if admin is logged in
    if (isAdmin) {
      addRecentActivity(currentLang === 'en' ? 'Crop Excel downloaded' : 'የሰብል Excel ተወርዷል');
    }
  }

  // Update statistics display
  function updateStats() {
      // Calculate total crops
      const totalCropsEl = document.getElementById('total-crops');
      if (totalCropsEl) totalCropsEl.textContent = crops.length;
      
      // Calculate total views
      const totalViewsEl = document.getElementById('total-views');
      if (totalViewsEl) {
        const totalViews = crops.reduce((sum, crop) => sum + (crop.views || 0), 0);
        totalViewsEl.textContent = totalViews.toLocaleString();
      }
      
      // Update other stats
      const totalDownloadsEl = document.getElementById('total-downloads');
      if (totalDownloadsEl) totalDownloadsEl.textContent = appStats.totalDownloads.toLocaleString();
      
      const totalFeedbackEl = document.getElementById('total-feedback');
      if (totalFeedbackEl) totalFeedbackEl.textContent = userFeedback.length;
      
      // Update recent activities
      updateRecentActivities();
    }
     function updateCategoryButtons() {
       const categoryButtons = document.querySelectorAll('.category-btn');
       categoryButtons.forEach(btn => {
         if (currentLang === 'am') {
             btn.textContent = btn.getAttribute('data-category-am');
         } else {
             btn.textContent = btn.getAttribute('data-category-en');
         }
    });
   }

  // Add recent activity
  function addRecentActivity(activity) {
    appStats.recentActivities.unshift({
      activity,
      timestamp: new Date().toISOString()
    });
    
    // Keep only the last 10 activities
    if (appStats.recentActivities.length > 10) {
      appStats.recentActivities.pop();
    }
    
    localStorage.setItem('appStats', JSON.stringify(appStats));
    updateRecentActivities();
  }

  // Update recent activities display
  function updateRecentActivities() {
    recentActivityList.innerHTML = '';
    
    appStats.recentActivities.forEach(activity => {
      const activityItem = document.createElement('div');
      activityItem.className = 'recent-activity-item';
      activityItem.innerHTML = `
        <p>${activity.activity}</p>
        <small>${new Date(activity.timestamp).toLocaleString()}</small>
      `;
      recentActivityList.appendChild(activityItem);
    });
  }

  // Initialize the application when the DOM is fully loaded
  document.addEventListener('DOMContentLoaded', initApp);
</script>
</body>
</html>